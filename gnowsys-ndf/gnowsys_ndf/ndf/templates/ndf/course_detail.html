{% extends "ndf/node_details_base.html" %}
{% load ndf_tags %}
{% load i18n %}
{% block title %} {{title}} {% endblock %}
{% block url %}{% url 'create_edit' groupid node %}{% endblock %}

<!-- overide head block from base.html -->
{% block head %}

<!-- <script src="/static/ndf/js/tree.jquery.js"></script> -->
<script src="/static/ndf/bower_components/jqtree/tree.jquery.js"></script> <!-- checked -->


{% endblock %}


<!-- overiding block from node_detail_base.html -->
{% block meta_content %}

{% endblock %}


<!-- overiding block_related content -->
{% block related_content %}
<!-- <section class="medium-6 large-12 columns">
  <h3>{% trans "Modules" %}</h3>
  <div class ="row">
    {% for each in node.collection_set %}
    bellow div for making tree from json data
    <div class="tree" data-url="{% url 'get_module_json' groupid %}?_id={{each}}"></div>
    {% endfor %}
  </div>
</section> -->
{% endblock %}

<!-- overiding block from node_detail_base.html -->
{% block collection_content %}
{% endblock %}

<!-- overiding block from node_detail_base.html -->
{% block body_content %}
{% get_group_name groupid as group_name_tag %}
<header class="row page">
<!--   <section class="medium-2 columns">
    <div class="label-list"> 
      {% for tag in node.tags %}
      <span class="radius label">{{tag}}</span> 
      {% endfor %}
    </div>
  </section>
 -->
   <section class="medium-10 columns" >
    <h2>
      <span class='node'>{{node.name}}</span>
      <span><a class="button" href="{% url 'create_edit' group_name_tag node.pk %}">{% trans "Edit" %}</a></span>
    </h2>
    <h3 class="subheader"></h3>
      <small>

  {{ node.last_update|timesince }}{% trans "ago edited by" %} <a class="user">{% trans "User" %}</a> <a href="#view-changes"><i class="fi-clock"></i> {% trans "View history" %}</a>

      </small>

  </section>
</header>

<div class="row">
  {% with node.html_content|safe as description %}
  {% if description != "None" %}
  {{ description }}
  {% endif %}
  {% endwith %}
</div>


<fieldset>
  <legend>
    {% trans "Course Structure Details "%}
  </legend>
  <div id="cs-div"></div>
  {% if not course_structure_exists %}<div>
  <label>{% trans "You haven't added any content to this course yet" %}</label></div>{% endif %}
  <span class="small-6 columns  end right inline" ><a class=" button" href="{% url 'create_course_struct' group_name_tag node.pk %}" target="_blank">{% if course_structure_exists %}{% trans "Edit  Course Structure" %}{% else %}{% trans "Add  Course Structure" %}{% endif %}</a></span>
</fieldset>

{% endblock %}


{% block document_ready %}
  {{block.super}}

  $(function() {
    $('.tree').tree({
     autoOpen: 0
   });
  });

  $('.tree').bind(
    'tree.click',
    function(event) {
      // The clicked node is 'event.node'
      var node = event.node;
      alert(node.id);
    }
    );

  {% for each_cs in node.collection_set %}
    {% get_node each_cs as cs_node %}
        cs_str = "<h6>"+{{forloop.counter}}+". {{cs_node.name}}</h6>"
        $("#cs-div").append(cs_str)
      {% if cs_node.collection_set %}
        {% for each_css in cs_node.collection_set %}
          {% get_node each_css as css_node %}
            css_str = "&nbsp;&nbsp;<h7>"+ {{forloop.counter}}+". {{css_node.name}}</h7><br>"
            $("#cs-div").append(css_str)
            {% if css_node.collection_set %}
              {% for each_unit in css_node.collection_set %}
                {% get_node each_unit as unit_node %}
                  cu_str = "&nbsp;&nbsp;&nbsp;&nbsp;<h7>"+ {{forloop.counter}}+". {{unit_node.name}}</h7><br>"
                  $("#cs-div").append(cu_str)
                  {% if unit_node.collection_set %}
                    {% for each_res in unit_node.collection_set %}
                      {% get_node each_res as res_node %}
                        {% if res_node %}
                          {% if res_node.member_of_names_list.0|lower == "page" or res_node.member_of_names_list.0|lower == "quiz" %}
                            k = "{% url res_node.member_of_names_list.0|lower|concat:"_details" groupid res_node.pk %}"
                          {% else %}
                            k = "{% url res_node.member_of_names_list.0|lower|concat:"_detail" groupid res_node.pk %}"
                          {% endif %}
                          var str_unit = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+ {{forloop.counter}}+". <a href='"+k+"' target='_blank' class='unit_name'>{{res_node.name}}</a><br>"
                          $("#cs-div").append(str_unit)
                      {% endif %}
                    {% endfor %}
                  {% endif %}
              {% endfor %}
            {% endif %}
        {% endfor %}
      {% endif %}
  {% endfor %}

{% endblock %}


