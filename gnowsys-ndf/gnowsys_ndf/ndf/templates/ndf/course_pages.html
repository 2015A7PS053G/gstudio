{% load i18n %}
{% load ndf_tags %}
{% block head %}
    <script src="/static/ndf/bower_components/jquery-ui/jquery-ui.js"></script> <!-- checked -->
      <script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.min.js"></script> <!-- checked -->
      <script src="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-sliderAccess.js"></script> <!-- checked -->
      <link rel="stylesheet" href="/static/ndf/bower_components/jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.css"> <!-- checked -->
      <link rel="stylesheet" type="text/css" href="/static/ndf/bower_components/jquery-ui/themes/smoothness/jquery-ui.css"> <!-- checked -->
    <style type="text/css">
    .right-btn, .left-btn{
        /*float: left;*/
        /*margin-left: 1rem;*/
        width: 40%;
        font-size: 0.85em !important;
        margin-top: 0.1rem !important;
        text-align: center;
    }
</style>

<style type="text/css">
    .right-btn, .left-btn{
        /*float: left;*/
        /*margin-left: 1rem;*/
        width: 40%;
        font-size: 0.85em !important;
        margin-top: 0.1rem !important;
        text-align: center;
    }
    .tag-rating-div{
        margin-left: 0.6rem !important;
        margin-top: 0.3rem !important;
    }
    /*  
    .right-btn{
        float: right;
        margin-right: 1rem;
        width: 8rem;
        font-size: 0.75rem !important
    }
    */
    .rating-lbl{
        display: inline-block;
        font-size: 1rem !important;
        /*font-style: italic;*/
        /*margin-left: 3rem;*/

    }
    .rating_template{
        display: inline-table;
    }
    .mod-btn{
        width: 80% !important;
        font-size: 0.75rem !important;
    }
    .btn-row{
        /*margin-left: 1rem !important;*/
        text-align: center;
        margin-bottom: -1rem !important;
    }
    .lbl_tag{
        display: inline-block;
        font-size: 0.80rem !important;
    }
    .lbl_field{
        width: 20%;
        color: #194d6f;
        /*font-weight: bold;*/
        margin-top: 1rem;
        font-size: 1rem !important;
    }
    .label > a{
        color: white !important;
    }

    .graph_btn{
        margin-left: 3rem;
    }

    #group_drawer{
        height: 400px;
        overflow-y: auto;
        margin-left: 2em;
    }
</style>
{% endblock %}

<!-- Handles Activity page detail and listing -->
{% if activity_node and not editor_view %}
    <div class="activity-detail-page">
        <div class="row">
            <div class="small-6 columns">
                <h4 class="page-name">{{activity_node.name}}</h4>
            </div>
            <div class="small-4 columns">
                 {% if activity_node.tags %}
                    {% for tag in activity_node.tags %}
                            <small><label class="tag-ele">
                        <a href="{% url 'tag_info' group_id tag %}">{{tag}} </a></label></small>
                    {% endfor %} 
                {% else %}
                    <i><small><label>{% trans "No tags defined yet!" %}</label></small></i>
                {% endif %}   
            </div>
                <a href="{% url 'all_translations' group_id activity_node.pk %}">Alternate Language</a>
            </div>

            <div class="small-2 columns">
                <span data-dropdown="activity-page-settings-drop" aria-controls="activity-page-settings-drop" aria-expanded="false" class="orange-button right">
                    Options
                </span>
                <ul id="activity-page-settings-drop" class="f-dropdown" data-dropdown-content aria-hidden="true" tabindex="-1">
            
                <li><a href="{% url 'all_translations' group_id activity_node.pk %}">Translate</a></li>
                <li><a class="edit-interaction">Edit Interaction Settings</a></li>            
                <li><a href="{% url 'edit_course_page' group_id activity_node.pk %}">Edit</a></li>
                <li><a href="{% url 'course_pages' group_id %}" >Back to Activities</a></li>
            </div>
        </div>
        <div class="row activity-detail-content">
            {% include "ndf/node_ajax_content.html" with node=activity_node %}
        </div>
    </div>


{% else %}
    {% if user.is_authenticated %}
        <div class="activity-sheet-actions">
            <div class="row">
            <a class="right orange-button-template" href="{% url 'create_course_page' group_id %}">Add Activity Page</a>
            </div>
        </div>
    {% endif %}


    <div id="page_listing">
    {% if all_pages.count %}
    <div class="row">
        <button type="button" class="orange-button delete-activity right" title="Click on the checkbox on the files below to Delete">Delete Activity</button>
    </div>
    {% endif %}
        <div class="row">
            {% for each in all_pages %}
                <a class="view-page" data-page-id="{{each.pk}}" data-node-name="{{each.name}}" title="{{each.name}}" href="{% url 'view_course_page' group_id each.pk %}">
                    <div class="small-12 medium-6 large-3 columns">
                        <div class="asset_tile">
                            <div class="asset_preview">
                                {% if each.if_file.mid.relurl and 'video' not in each.if_file.mime_type %}
                                <img src="{{MEDIA_URL}}{{each.if_file.mid.relurl}}">
                                {% elif 'video' not in each.if_file.mime_type and each.if_file.thumbnail.relurl %}
                                <img src="{{MEDIA_URL}}{{each.if_file.thumbnail.relurl}}">
                                {% else %}
                                <img src="/static/ndf/images/asset_thumbnail.png">
                                {% endif %}
                            </div>
                            <div class="asset_text">
                                <div class="asset_title" title="{{each.name}}">{{each.name|truncatechars:25}}</div>
                                    {% if user.is_authenticated  and not group_object.edit_policy == "NON_EDITABLE"  or gstaff_access %}
                                    <input type="checkbox" class="activitynode" name="activitynode" value="{{each.pk}}" style="margin:0; float:right;" class="asset_content_checkbox">
                                    {% endif %}
                                <div class="asset_desc">{{each.content|safe|striptags|truncatechars:35}}</div>
                            </div>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>
    </div>



{% endif %}

<script type="text/javascript">
    $(".delete-activity").click(function(){
        var checked = $('.activitynode:checked').length;
        if (checked > 0){

            if (confirm("Do you want to delete selected files?.") == true) {
                coll_arr = []
                $('.activitynode:checked').each(function() {
                    coll_arr.push($(this).val());
                });

                $.ajax({
                          type: "POST",
                          data:{
                                'csrfmiddlewaretoken': "{{csrf_token}}",
                                'delete_files_list' : coll_arr,
                            },
                          url: "{% url 'delete_activity_page' group_id %}",
                          datatype: "json",
                          success: function(data) {
                            console.log(data)
                            if (data=="success"){
                                location.reload()
                            }
                            else{
                                alert("Something went wrong. Please try again later.")
                            }
                        }
                    });

                }
        }
        else{
            alert("Choose atleast one Activity");
        }


    });

    $( ".edit-interaction" ).click(function(event) {
  $.ajax({
              type: "POST",
              data:{
                    'csrfmiddlewaretoken': "{{csrf_token}}",
                    "node_id":'{{activity_node.pk}}',
                },
              url: "{% url 'get_interaction_widget' group_id  %}",
              datatype: "html",
              success: function(data) {
              $('#addAsset').foundation('reveal', 'open');
              $('#addAsset').html(data);
            }
        });
});
    
</script>
