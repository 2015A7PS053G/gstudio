{% load ndf_tags %}


<ul class="side-nav">
    <!-- Breadcrumbs List on top of collections on resource page   -->
    <nav class="breadcrumbs">
    <!-- showing current page name with border and highlight -->
    {% for key,value in breadcrumbs_list %}
       <a name="{{key}}">{{ value }}</a>
    {% endfor %}
  </nav>
  <!-- Breadcrumbs List on top of collections on resource page   -->

  {% if node.collection_dict|length > 0 %}

  {% for index_key, each_node in node.collection_dict.items %}
  {% get_grid_fs_object each_node as grid_fs_obj %}
  
  {% if each_node.collection_set %}
  <li>
   
      <h5>
      <a class="select" class="collection" name="{{each_node.pk}}"><i class="fi-page-multiple"></i>
          {% if 'image' in each_node.mime_type %}<i class="fi-camera"></i>  {% endif %}
    
     {% if 'video' in each_node.mime_type %}<i class="fi-video"></i>  {% endif %}
   
     {% if 'Pandora_video' in each_node.member_of_names_list %}<i class="fi-video"></i>  {% endif %}
          {{ each_node.name }}</a>
      </h5>
  </li>

{% else %}
  
  <li>
      <h6 class="{{ each_node.type }}">
        <a class="select" name="{{each_node.pk}}">{{ each_node.name }}</a>
      </h6>
  </li>

</ul>

  {% endif %}
  {% endfor %}
{% endif %}

<ul class="no-bullet">

    <a class="bc" name="{{key}}">{{ value }}</a>

  <!-- current page title -->
  {% for key,value in breadcrumbs_list %}
  {% get_memberof_name key as member_of_name %}
  <li id="{{key}}" class="loadSelectedResource">
    <div class="row" title="{{member_of_name}}">
      <div class="small-2 columns">
        <i class="fi-page-filled"></i>
      </div>
      <div class="small-10 columns" name="{{key}}">{{ value }}</div>
    </div>
  </li>
  {% endfor %}

  {% if node.collection_dict|length > 0 %}

    {% for index_key, each_node in node.collection_dict.items %}
    {% get_memberof_name each_node.pk as member_of_name %}

      <li id="{{each_node.pk}}" class="loadSelectedResource">
        <div class="row" name="{{each_node.pk}}" title="{{member_of_name}} - {{each_node.mime_type}}">
          <div class="small-2 columns">

            {% if "/zip" in each_node.mime_type %}
              <i class="fi-archive"></i>
            {% elif "image" in each_node.mime_type %}
              <!-- <i class="fi-camera"></i> -->
              <img src="{% url 'getImageThumbnail' groupid each_node.pk %}">
            {% elif "/pdf" in each_node.mime_type %}
              <!-- <i class="fi-page-pdf"></i> -->
              <img src="{% url 'getFileThumbnail' group_id each_node.pk %}">
            {% elif "ogg" in each_node.mime_type or "video" in each_node.mime_type %}
              <i class="fi-video"></i>
              <!-- <img src="#{#% url 'getvideoThumbnail' group_id each_node.pk %}"> -->
              <!-- <div style="background:url#(#url 'getvideoThumbnail' group_id each_node.pk)"></div> -->
            {% else %}
              <i class="fi-page-filled"></i>
            {% endif %}
          
          </div>
          <div class="small-10 columns" >
            {{ each_node.name }}
          </div>
        </div>
      </li>

    {% endfor %}
  {% endif%}
  
</ul>


<script>

$(document).on('click', 'li.loadSelectedResource', function (e) {
    $.ajax({

      type: "POST",
      url: "{% url 'collection_nav' groupid %}",
      datatype: "html",
      data:{
        node_id: this.id,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      
      success: function(data) {
        // console.trace()
        // var prevHTML = $(document).children();
        $("#view_page").html(data);
        // $("#view_page").foundation({bindings:'events'});
        $("#view-map-widget, a[data-reveal-id='view-map-widget'], a[href='#view-graph']").foundation();
        // $("#graph-hover").foundation({dropdown:{is_hover:false,active_class:'open'});        
        // window.history.pushState(“object or string”, “Title”, “/new-url”);
        // window.history.pushState({"html":prevHTML, "pageTitle":"try"},"", "#try");
        // window.location.hash = this.id;
      }

    });
  });

  $(".select").click(function() {

  	$.ajax({
      type: "POST",
      url: "{% url 'collection_nav' groupid %}",
      datatype: "html",
      data:{
        node_id: this.name,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(data) {
        $("#view_page").html(data);
      }
    });

  	$.ajax({
      type: "POST",
      url: "{% url 'collection_view' groupid %}",
      datatype: "html",
      data:{
        node_id: this.name,
        breadcrumbs_list: '{{ breadcrumbs_list }}',
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(data) {
        $("#view_collection").html(data);
      }
    });

  });

  $("aside .breadcrumbs a").click(function() {

    $.ajax({
      type: "POST",
      url: "{% url 'collection_nav' groupid %}",
      datatype: "html",
      data:{
        node_id: this.name,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(data) {
        $("#view_page").html(data);
      }
    });

    $.ajax({
      type: "POST",
      url: "{% url 'collection_view' groupid %}",
      datatype: "html",
      data:{
        node_id: this.name,
        modify_option: 'delete',
        breadcrumbs_list: '{{ breadcrumbs_list }}',
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success: function(data) {
        $("#view_collection").html(data);
      }
    });


  });

</script>
