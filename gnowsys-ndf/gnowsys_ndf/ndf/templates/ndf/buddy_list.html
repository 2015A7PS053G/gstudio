<h2 id="modalTitle">+ Add your buddy</h2>

<a class="close-reveal-modal" aria-label="Close">&#215;</a>

{% include 'ndf/widget_selector.html' with for='select_buddies' all_options=all_inst_users selected_options=buddies_id_list oneline_element='true' %}

<div class="button tiny expand" id="add-selected-buddies">Done !</div>

<script type="text/javascript">
	addBuddies = document.getElementById('add-selected-buddies');
	addBuddies.onclick = saveBuddies;

	function saveBuddies () {
		var selectedBuddiesArr = getSelectedValues('select_buddies');
		// console.log(selectedBuddiesArr)
		// console.log(JSON.stringify(selectedBuddiesArr))
		// alert(selectedBuddiesArr)

		$.ajax({
			url: "{% url 'update_buddies' group_id %}",
			type: 'POST',
			data: {
				selected_buddies_list: JSON.stringify(selectedBuddiesArr),
				csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function (data) {
				// console.log(data);

				oidNameObj = JSON.parse(data);

				displayMsg = userNames = '';

				for(var eachUserName in oidNameObj){
					console.log(oidNameObj[eachUserName]);
					userNames += '\n- ' + oidNameObj[eachUserName]
				}
				console.log(userNames);

				if (userNames)
				{
					displayMsg = 'Currently, following are your buddies:\n'
					displayMsg += userNames;
				}
				else
				{
					displayMsg = 'Currently, you have NO buddies:\n'
				};

				alert(displayMsg);
			}
		});

	}
</script>