{% extends "ndf/base.html" %}
{% load ndf_tags %}
{% load i18n %}
{% block title %} {{username}}'s - Dashboard  {% endblock %}

{% block meta_content %}
  <h3>{% trans "About" %}</h3>

  {% blocktrans %}<b>Group Dashboard</b> Shows task(s) and activitie(s) in the site.{% endblocktrans %}
<form class="dropzone" id ="docPost" enctype="multipart/form-data" method="post" action="{% url 'group_dashboard' group_id %}">
      					{% csrf_token %}       
<div   id="group_dashboard_Banner"  style="height:200px; class='div-height' width:1150px;  background-color: #b0e1df;">
<div class="row">
<div class="small 1 column">
<input type="file" name="Group_has_profile_pic"  accept="image/*"  />
</div>
<div class="small 1 column">
<input type="submit"  value="Save" style="font-size:15px;"  />
</div>
</div>  
  {% if prof_pic_obj %}
           <img src="{% url 'read_file' group_id prof_pic_obj.pk grid_fs_obj.filename %} " style="height:200px; width:300%; position:absolute z-index: auto; " >
          
          {% get_grid_fs_object prof_pic_obj as grid_fs_obj %}
          {% endif %}   
       
               
                {% comment %} <input type="text" id="txtSelectedFiles"  class="small-12 columns margin-p5" class="hide"> {% endcomment %}
      					
      					<input type="file" name="has_profile_pic"  class="hide" />
                <input type="hidden" name="type" value="profile_pic">           
                <input type="hidden" name="user" value="{{usr}}">         

      					<p id="message" style="display:none">
      						{% trans "Please wait for uploading profile picture" %}
      					</p>

</div>



</form>             

{% endblock %}

{% block style %}
  {{block.super}}

  /* Setting css-properties for reveal-modal's label */
    div.reveal-modal > label {
      color: white;
      font-weight: bold;
      font-size: 1rem;
    }

  /* Disable tab's (anchor tag's) click as it's navigation is propagated on buttons (Next & Previous) */
    .row .row {
      margin: 0 0;
    }

  /* css-properties for table */
    .width_s_no {
      width: 5%;
    }
    
    .div-height {
    margin-bottom: 0.5em; 
    height: 9em;
     }

    .counter {
      font-weight: bold;
      text-align: right;
    }

    .width_Status, .width_Completed_On, .width_Enrolled, .width_Remaining, .width_Approved, .width_Rejected {
      width: 8%;
    }

    .width_19p {
      width: 19%;
    }

    .width_delete {
      width: 8%;
      line-height: 0.5em;
      text-align: center !important;
    }

    .margin-0r {
      margin: 0 !important;
    }

    .counter {
      font-weight: bold;
      text-align: right;
    }
.img-height {
    height: 100%;
  }
    .tiny.button {
      font-size: 1em !important;
    }
{% endblock %}

{% block body_content %}

<div id="alertModal" class="reveal-modal medium alert-box radius" data-reveal data-alert>
  <label id="alertModalLabel"></label>
  <a class="close-reveal-modal">&#215;</a>
</div>

<nav class="row" style="margin-top: 0.5rem;">
  <dl class="tabs small-12 columns" data-tab data-options="deep_linking:true">
    {% if approval %}
    <dd class="active" title="Enrollment Approval Details">
      <a href="#panel_enrollment_approval_details">
        {% trans "Approval" %}
      </a>
    </dd>
    {% endif %}

    <!--
    <dd class="{% if not approval %}active{% endif %}" title="Testing Details">
      <a href="#panel_testing_details">
        {% trans "Testing" %}
      </a>
    </dd>
    -->
  </dl>
</nav>

<div id="containerdiv" style="border-style: solid; border-width: 1.5px; border-color: #b0e1df; padding: 0px 0px; height:380px; width:1152px; background-color: white;" >

<!-- Banner Div -->
    				
             <form class="dropzone" id ="docPost" enctype="multipart/form-data" method="post" action="{% url 'group_dashboard' group_id %}">
      					{% csrf_token %}       
                     
    <div   id="group_dashboard_Banner"  style="height:300px; class='div-height' width:1150px;  background-color: #b0e1df;">
        <div>
        <a style="border-style:solid; border-width:1.5px; padding:3px 5px; border-radius:4px" id="btnUploadBannerPic" >  Add a Banner Photo </a> </a> 
         <input type="submit" id="submitpostid" value="Save" style="font-size:15px;"  />
          
          {% if banner_pic %}
           <img src="{% url 'read_file' group_id banner_pic.pk grid_fs_obj.filename %} " style="height:300px; width:300%; position:absolute z-index: auto; " >
          
          {% get_grid_fs_object  banner_pic as grid_fs_obj %}
          {% endif %}   
        
        <div class="row">
          <div class="row" style="margin-top:80px; margin-left:20px; background: transparent;position:absolute z-index:1"  align="Left">
                       
      					
      					<input type="file" name="has_Banner_pic" id="docFile" accept="image/*" class="hide" />

                {% comment %} <input type="text" id="txtSelectedFiles"  class="small-12 columns margin-p5" class="hide"> {% endcomment %}
      					
                <input type="hidden" name="type" value="banner_pic">           
                <input type="hidden" name="user" value="{{usr}}">         

      					<p id="message" style="display:none">
      						{% trans "Please wait for uploading profile picture" %}
      					</p>
      						
      				</form>

              </div> 
           
          </div>
        </div>
    </div>  
    <br>
<div class="row">    
<div class="small-1 column">
</div> 
 <div class="small-11 column" > 
  <div class="tabs" >
    <div class="tab" >  
      <dl class="tabs" data-tab data-options="deep_linking:true" >
            <dd ><a  href="#Activities-div"  name="Activity" > Activity </a></dd> 
            <dd ><a  href="#view-scheduler-calendar"  name="Schedular" > Schedular </a></dd>
      </dl>
    </div> 
   </div>      
 </div>
</div>


</div>    
<!-- tab space -->    
<!-- tab space ends here -->
<!--banner div end here -->
<br>
<br>


<div id="group_dashboard_details" class="tabs-content" style="border-style: solid; border-width: 1.5px; border-color: #0eacb5; padding: 0px 5px;">

 {% if approval %}
  <!-- Tab: Enrollment Approval Details -->
  <div class="active content row" id="panel_enrollment_approval_details">
    <dl class="accordion" data-accordion>
      <!-- Enrollment Details -->
      <dd class="accordion-navigation">
        <a href="#enrollment_accordion">{% trans "Enrollment Details" %}</a>
        <div id="enrollment_accordion" class="content active">
          {% if enrollment_details %}
          <table>
            <thead>
              <th class="width_s_no counter">{% trans "S. #" %}</th>
              {% for each_column in enrollment_columns %}
              <th class="width_{{each_column}}">{{each_column}}</th>
              {% endfor %}
            </thead>

            <tbody>
              {% for each in enrollment_details %}
              <tr id="{{each|get_dict_item:'_id'}}">
                <td class="counter">{{forloop.counter}}.</td>
                {% for each_key in enrollment_columns %}
                <td class="width_{{each_key}}">
                  <a href="#" class="detail-view {{each_key}}">
                    {{each|get_dict_item:each_key}}
                  </a>
                </td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>  
          </table>
          {% else %}
          <h4>Nothing there to be approved!!</h4>
          {% endif %}
        </div>
      </dd>

      {% if enrollment_details %}
      <!-- Approval Details -->
      <dd class="accordion-navigation">
        <a href="#approval_accordion">{% trans "Approval Details" %}</a>
        <div id="approval_accordion" class="content">
        </div>
      </dd>
      {% endif %}
    </dl>
  </div>
  {% endif %}

  {% comment %}
  <!--
  <div class="{% if not approval %}active {% endif %}content row" id="panel_testing_details">
  testing 
  </div>
  -->
  {% endcomment %}


</div>

<div class="tabs-content">

  <div class="content active" id="Activities-div">
   <div align="center">
   <h4 align="left"> Images </h4> 
   <div class="row" style="border-style: solid; border-width: 1.5px; border-color: #b0e1df; padding: 0px 5px; background-color: white; height:200px;  width:800px; " >
    {% for i in file_list %}
      <div class="small-2 column" >

    			    <div >
    					<img src="{% url 'getFileThumbnail' group_id i.pk %}" class="img-height">
              <h6> {{i.name|truncatechars:20 }}</h6>
              </div>
      </div>
    
    {% endfor %}
    </div>
  </div>  

  <div align="center"> 
  <h4 align="left"> Activities </h4>
   <div style="border-style:solid; height:1000px;  width:800px; background-color: white ; border-width:1.5px; border-color:#b0e1df; padding:3px 5px; border-radius:4px" align="left"> 
    {% for i in  activity_list %}
           <h5><b>{{i.name|truncatewords:"20"}}</b></h5> 
           <br>
           by {{i.created_by}}
           {{i.content}}
           <br>
           
           
           
               
    {% endfor %}
    </div>
  
 </div> 
</div>  
  
  


<div class="content" id="view-scheduler-calendar">
  {% include "ndf/scheduler_calender.html"  %}
  
  </div>
</div>


{% endblock %}

{% block script %}

$(document).ready(function(){

});

$("input:not('#docFile')").each(function() {
		$(this).bind('keydown keypress keyup change', function() {
			var search = (this.value).toLowerCase();    	
    		var resource = (this.name); 
    		var $li = $("#"+resource+"_drawer li.bullet-item").hide();  

    		$li.filter(function() {    		    		
      			return $(this).text().toLowerCase().indexOf(search) >= 0;
    		}).show();
  		});
    });
$("#btnUploadProfilePic").click(function() {
    $("#docFile").trigger("click");
  });

$("#btnUploadBannerPic").click(function() {
    $("#docFile").trigger("click");
  });

$('#docFile').on("change", function() {
    $("#pic_div").removeClass("hide");

    file_mime_type = this.files[0].type;
    if(file_mime_type.indexOf("image/") < 0){
      $(this).val("");
      $('#docFile').val(this.value);

      var message = "{% trans 'Only image files should be selected for setting your profile picture!' %}"
      $("#alertModalLabel").text(message);
      $("#alertModal").addClass("alert");
      $("#alertModal").foundation('reveal', 'open');

      $("#pic_div").addClass("hide");
    }

    
  });

	$("#submitpostid").click(function() {
		if($("#docFile").val() != "") {	
			$("#message").show();
			$("#submitpostid").hide();
		}

		else {
      var message = "{% trans 'Please select an image to set it as a profile picture !' %}"
      $("#alertModalLabel").text(message);
      $("#alertModal").addClass("warning");
      $("#alertModal").foundation('reveal', 'open');

      $("#pic_div").addClass("hide");

			return false;
		}
	});



$(document).on("click", ".checkAllStudents", function(){
  $(".approveStudent").prop("checked", $(this).is(":checked"));
});

$(".detail-view").click(function(event) {
  event.preventDefault();

  enrollment_id = $(this).closest("tr").attr("id");

  approval_data_review = "";
  success_state = false;
  $.ajax({
    url: "{% url 'get_students_for_approval' groupid %}",

    data: {
      'enrollment_id': enrollment_id,
      'csrfmiddlewaretoken': "{{csrf_token}}"
    },

    type: "POST",

    dataType: "json",

    success: function(data) {
      success_state = data["success"];

      if (success_state) {
        approval_data_review = data["approval_data_review"];
      }

      else {
        $("#alertModalLabel").text(data["message"]);
        $("#alertModal").removeClass("success").removeClass("warning");
        $("#alertModal").addClass("alert");
        $("#alertModal").foundation('reveal', 'open');
      }
    },

    complete: function() {
      if (success_state) {
        $("#approval_accordion").empty().html(approval_data_review);
        $("#enrollment_accordion").removeClass("active");
        $("#approval_accordion").addClass("active");
      }
    },
  });
})

$(document).on("click", ".btnApproval", function() {
  students_selected = []
  $(".approveStudent:checked").each(function() {
    students_selected.push($(this).attr("id"));
  });

  approval_state = $(this).val();

  if (students_selected.length <= 0) {
    if (approval_state == "Approve") {
      $("#alertModalLabel").text("Please select any students for approval !!!");
    }

    else {
      $("#alertModalLabel").text("Please select any students for rejection !!!");
    }

    $("#alertModal").removeClass("success");
    $("#alertModal").addClass("warning");
    $("#alertModal").foundation('reveal', 'open');

    return;
  }

  enrollment_id = $("#enrollment_id").val();

  course_id = $("#course_id").val();

  success_state = false
  approved = ""
  rejected = ""
  remaining = ""
  $.ajax({
    url: "{% url 'approve_students' groupid %}",

    data: {
      'approval_state': approval_state,
      'enrollment_id': enrollment_id,
      'course_id': course_id,
      'students_selected': students_selected,
      'csrfmiddlewaretoken': "{{csrf_token}}"
    },

    type: "POST",

    dataType: "json",

    success: function(data) {
      success_state = data["success"];

      if (success_state) {
        approved = data["approved"];
        rejected = data["rejected"];
        remaining = data["remaining"];
      }

      else {
        $("#alertModalLabel").text(data["message"]);
        $("#alertModal").removeClass("success").removeClass("warning");
        $("#alertModal").addClass("alert");
        $("#alertModal").foundation('reveal', 'open');
      }
    },

    complete: function() {
      if (success_state) {
        $("#"+enrollment_id).find(".Approved").text(approved)
        $("#"+enrollment_id).find(".Rejected").text(rejected)
        $("#"+enrollment_id).find(".Remaining").text(remaining)

        $("#approval_accordion").removeClass("active");
        $("#enrollment_accordion").addClass("active");
      }
    },
  });
});

{% endblock %}
