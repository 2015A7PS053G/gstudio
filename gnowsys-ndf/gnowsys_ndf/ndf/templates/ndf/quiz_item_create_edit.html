{% extends "ndf/base.html" %}
{% load i18n %}
{% load ndf_tags %}

{% block title %} {{title}} - {% if node %}{% trans 'Edit' %}{% else %}{% trans 'Create' %}{% endif %}  {% endblock %}

{% block style %}

.quiz-type-based-div{
    display: none;
}

{% endblock %}


{% block body_content %}
{% get_group_name groupid as group_name_tag %}
<form id="quiz_item_create_form" method="POST" action="">
{% csrf_token %}
	{% if quiz_node_id %}
		<input type="hidden" name="quiz_node_id" value="{{quiz_node_id}}">
	{% endif %}
	<div id="node-details-edit-div" class="tabs-content" >
		<div class="active content row" id="panel-name-description"> 
			<div class="row text-center">
				<div class="small-4 large-2 columns">
					<label for="quiz_type" class="right inline">{% trans "Select Question Type" %}</label>
				</div>

				<div class="small-5 large-5 columns left">
					<select id="quiz_type" name="quiz_type" autofocus {% if node.quiz_type %}disabled{% endif %}>
					<option value=""> --- Select Quiz Type --- </option>
					{% for choice in quiz_type_choices %}
					<option value="{{choice}}" {% ifequal node.quiz_type choice %}selected{% endifequal %}>{{choice}}</option>
					{% endfor %}
					</select>
					<input id="quiz_type_val" name="quiz_type_val" type="hidden" value="{{node.quiz_type|default_if_none:""}}" />
				</div>
			</div>

			<div class="row">
				<div class="small-4 large-2 columns">
					<label class="right inline">{% trans "Enter Question" %}</label>
				</div>

				<div class="small-8 large-8 columns left ">
					{% include "ndf/add_editor.html" with var_name="content_org" var_placeholder="Enter Question here.." var_value=node.content_org %}
				</div>
			</div>

			<div class="row" id="options" style="display:none;">
				<div class="small-4 large-2 columns">
					<label for="quiz_type" class="right inline">{% trans "Options" %}</label>
				</div>

				<div class="small-8 large-8 columns left">
				{% for option in node.options %}
					<div class="row" id="option_div{% if not forloop.first %}_{{forloop.counter}}{% endif %}">
						<div class="small-1 large-1 columns">
						<label for="option" class="right inline">{{forloop.counter}}.</label>
						</div>
						<div class="small-11 large-11 columns">
						<textarea id="option{% if not forloop.first %}_{{forloop.counter}}{% endif %}" name="option{% if not forloop.first %}_{{forloop.counter}}{% endif %}" rows="2" placeholder="Enter option here...">{{option}}</textarea>
						</div>
					</div>
				{% empty %}

					<div class="row" id="option_div">
						<div class="small-1 large-1 columns">
							<label for="option" class="right inline">1.</label>
						</div>
						<div class="small-11 large-11 columns">
							<textarea id="option" name="option" rows="2" placeholder="Enter option here..."></textarea>
						</div>
					</div>
					<div class="row" id="option_div_2">
						<div class="small-1 large-1 columns">
							<label for="option_2" class="right inline">2.</label>
						</div>
						<div class="small-11 large-11 columns">
							<textarea id="option_2" name="option_2" rows="2" placeholder="Enter option here..."></textarea>
						</div>
					</div>
				{% endfor %}

				<input id="add_option" name="add_option" type="button" class="button small" style="float:right;" value="+ Add Option"/>

				<input id="no_of_options" name="no_of_options" type="hidden" value="{% if node%}{{node.options|length}}{% else %}2{% endif %}" />

				</div>
			</div>

			<div class="row hide quiz_type_based_correct_ans_div">

				<div class="small-4 large-2 columns">
					<label for="quiz_type" class="right inline">{% trans "Correct Answer" %}</label>
				</div>
				{% comment %}

				<div class="quiz-type-based-div small-8 large-8 columns left" id="Short-Response">
					<textarea id="correct_answer_short" name="correct_answer_short" rows="2" placeholder="Enter correct answer...">{{node.correct_answer.0|default_if_none:""}}</textarea>

				</div>
				{% endcomment %}

				<div class="quiz-type-based-div small-8 large-8 columns left" id="Single-Choice">
					<select id="correct_answer_single" name="correct_answer_single">
					{% for option in node.options %}
						<option value="{{forloop.counter}}" {% ifequal node.correct_answer.0 forloop.counter|slugify %}selected{% endifequal %} >{{forloop.counter}}</option>
						{% empty %}
						<option value="1">1</option>
						<option value="2">2</option>
					{% endfor %}
					</select>
				</div>

				<div class="quiz-type-based-div small-8 large-8 columns left" id="Multiple-Choice">
					<select id="correct_answer_multiple" name="correct_answer_multiple" multiple style="height:75px;">
					{% for option in node.options %}
						<option value="{{forloop.counter}}" {% if forloop.counter|slugify in node.correct_answer %}selected{% endif %} >{{forloop.counter}}</option>
						{% empty %}
						<option value="1" selected>1</option>
						<option value="2">2</option>
					{% endfor %}
					</select>
				</div>
			</div>

			<div class="row">
				<div class="small-4 large-2 columns">
					<label class="right inline">{% trans "Show Correct Answer " %}<br/>
					<small>(To allow a user to see Correct Answer)</small></label>
				</div>

				<div class="small-8 large-8 columns left">
					<select name="show_correct_ans" class="sel_show_correct_ans">
						<option value="True" >True</option>
						<option value="False">False</option>
					</select>
				</div>
			</div>

			<div class="row">
				<div class="small-4 large-2 columns">
					<label class="right inline">{% trans "Problem Weight " %}
					</label>
				</div>

				<div class="small-8 large-8 columns left">
					<input type="text" name="problem_weight" value="{% if node %}{{node.quizitem_problem_weight}}{% else %}1{% endif %}">
				</div>
			</div>

			<div class="row">
				<div class="small-4 large-2 columns">
					<label class="right inline">{% trans "Maximum Attempts " %}
					</label>
				</div>

				<div class="small-8 large-8 columns left">
					<input type="text" name="maximum_attempts" value="{% if node %}{{node.quizitem_max_attempts}}{% else %}1{% endif %}">
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="small-1 columns">
			<input id="save_quiz_item" name="save_quiz_item" type="submit" class="button small" value="Save"/>
		</div>
	</div>

</form>

<script type="text/javascript">

/*
 * Element     : quiz_type
 * Type        : select (Drop-down list)
 * Event       : on change
 * Description : 
   (1) Based on which type of quiz is selected, it's corresponding answer-div is displayed (along with options, wherever required). 
 */
 $(document).ready(function(){
	{% if node %}
		$(".sel_show_correct_ans").val("{{node.quizitem_show_correct_ans}}")
	{% endif %}
 })

$('#quiz_type').change(function (){
    $("#quiz_type_val").val($(this).val())
    var targetDivId = $(this).val();
    console.log(targetDivId)
    if(targetDivId == "Single-Choice" || targetDivId == "Multiple-Choice"){
    	$(".quiz_type_based_correct_ans_div").removeClass("hide");
	    if ($(this).val() != $('#' + $(this).attr('id') + ' option:nth-child(1)').val()) {
			$('#options').css('display', 'block');
	    }
	    else {
			$('#options').css('display', 'none');
	    }
	    $('.quiz-type-based-div').hide('fast');
	    $('div#' + targetDivId).show('fast');
    }
    else if(targetDivId == "Short-Response"){
    	$(".quiz_type_based_correct_ans_div").addClass("hide");
		$('#options').css('display', 'none');
	    $('div#' + targetDivId).hide('fast');
    }

}).change();

/*
 * Element     : quiz_type
 * Type        : select (Drop-down list)
 * Event       : on change
 * Description : 
   (1) Based on which type of quiz is selected, it's corresponding answer-div is displayed (along with options, wherever required). 
 */

var no_of_options = 2;
/*
 * Element     : add_option
 * Type        : button
 * Event       : on click
 * Description : 
   (1) It clones the structure of very first option element (div) and does the necessary renaming of it's elements; and then after pastes it above 
       the '+ Add Option' button.
   (2) Also adds the corresponding option number to the correct answer's drop-down list.
 */
$('#add_option').click(function (){
    no_of_options = no_of_options + 1;

    // Cloneing the very first option's div
    var option_div_clone = $('#option_div').clone();

    // Performing renaming of it's various elements
    var name_val = 'option_div_' + no_of_options;
    option_div_clone.attr({id: name_val, name: name_val});

    option_div_clone.children().children('label').text(no_of_options + '.');
    option_div_clone.children().children('label').attr('for', 'option_' + no_of_options);

    option_div_clone.children().children('textarea').attr({id: 'option_' + no_of_options, name: 'option_' + no_of_options});

    // Pasting the cloned element, after modifying it, above the '+ Add Option' button
    $(this).before(option_div_clone);

    // Fetching the appropriate correct answer (having drop-down list) based on the option selected (Single-choice/Multiple-choice) 
    drop_down_answer_list_div_id = $('div#' + $('#quiz_type').val()).attr('id');
    
    // Fetching the corresponding drop-down list & appending the option number to it
    drop_down_answer_list = $("#" + drop_down_answer_list_div_id).children('select');
    drop_down_answer_list.append($('<option>', {value:no_of_options, text:no_of_options}));

    // Updating number of options value to hidden element
    $("#no_of_options").val(no_of_options);
});

</script>

{% endblock %}

