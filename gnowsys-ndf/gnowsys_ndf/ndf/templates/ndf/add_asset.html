

<div class="row" style="margin-top: 25px; margin-bottom: 25px;">
            <a class="close-reveal-modal" aria-label="Close">&#215;</a>
            <div class="small-12 colums" >
                <h3 class="left">Add a new asset</h3>
                <button type="button" class="right orange-button save-asset">Save Asset</button>
            </div>
        </div>
        <div class="row">
            <div class="small-12 medium-6 large-6 columns">
                <label>
                    {% if asset_obj.name %}
                        {{asset_obj.name}}
                    {% else %}
                       Asset name 
                       <input type="text" placeholder=""  id = "asset-name" name="asset_name" />
                    {% endif %}

                </label>
            </div>
        </div>
        <div class="row">
            <div class="small-12 medium-6 large-6 columns">
                <label> 
                    {% if asset_obj.content %}
                        {{asset_obj.content}}
                    {% else %}
                        Asset description
                        <input type="text" placeholder="" id = "asset-descid" name="asset_desc" />
                    {% endif %}
                </label>
            </div>
        </div>
        <div class="row">
            <div class="small-12 medium-6 large-6 columns">
                <label>Tags
                    <input type="text" placeholder="" name="asset_tags" />
                </label>
            </div>
        </div>
        <div class="row">
            <div class="small-12 medium-6 large-6 columns">
                <label>Learning objectives met by this asset
                    <Select name="asset_objectives" id = "asset_objectivesid" placeholder="Select topics" require>
                        <option value="">--- Select Topic ---</option>
                        {% for each_topic in topic_nodes %}
                        <option value="{{each_topic.pk}}">
                            {{each_topic.name}}
                        </option>
                        {% endfor %}
                    </Select>
                </label>
            </div>
        </div>

        <hr />
    <div class="asset-content-area"{% if not asset_obj %} style="display:none"{% endif %}>
        <h3>Resources for this asset</h3>
        <div class="row">
            Add asset content
            <div class="transcript_files">
                <form class="dropzone" id ="docPost" enctype="multipart/form-data" method="post" action="{% url 'add_assetcontent' group_id %}" >
                    <input type="file" id="docFile" placeholder="" name="work" />
                    <input type="button" id="" onclick="save_form()" value="Save"/>
                    <input type="hidden" name="context_name" value="{{title}}">
                    <input type="hidden" class ="asset_obj_val" name="asset_obj_name" data-asset-obj-val="">
                </form>
             </div>
        {% for each in asset_content_list.grel_node %}
            <a href="{% url 'assetcontent_detail' group_id asset_obj.pk each.pk %}">
            <div class="small-12 medium-6 large-3 columns">
                    
                <div class="asset_tile">
                    <div class="asset_preview"></div>
                    <div class="asset_text">
                        <div class="asset_title">{{each.name}}</div>
                        <div class="asset_desc">This is a long description</div>
                    </div>
                </div>
            </div>
                {% endfor %} 
        </div>

        <hr />
        <h6>
            <b><u>All Assets</u>&nbsp; ></b>
            Resource Name
        </h6>
        <div class="row">
          {% if node %}
            {% include "ndf/asset_content_detail.html" with node=node %}
        {%  endif %}
        </div>
    </div>
<script type="text/javascript">
    $( ".save-asset" ).click(function() {
        asset_name = $("#asset-name").val();
        asset_description = $("#asset-descid").val();
        asset_objective =  $('#asset_objectivesid').find(':selected').attr('value');
        $.ajax({
              type: "POST",
              data:{ "works":"works",
                    'csrfmiddlewaretoken': "{{csrf_token}}",
                    "asset_name":asset_name,
                    "asset_description":asset_description,
                    "asset_objective":asset_objective
                },
              url: "{% url 'create_edit_asset' group_id %}",
              datatype: "html",
              success: function(data) {
                // $('#addAsset').html(data);
                // $('#addAsset').foundation('reveal', 'open');
                $('.asset-content-area').css('display', 'block')
                alert(data)
                $('.asset_obj_val').attr('data-asset-obj-val',data);
            }

      });

    });
</script>
<script type="text/javascript">
  var form = document.getElementById('docPost');
  var fileSelect = document.getElementById('docFile');
  // var uploadButton = document.getElementById('submitpostid');
        function save_form(event) {
        assetval = $('.asset_obj_val').attr('data-asset-obj-val');
        // Update button text.
        // uploadButton.innerHTML = 'Uploading...';

        // Get the selected files from the input.
        var files = fileSelect.files;

        // Create a new FormData object.
        var formData = new FormData();

        // Loop through each of the selected files.
        for (var i = 0; i < files.length; i++) {
          var file = files[i];

          // // Check the file type.
          // if (!file.type.match('image.*')) {  continue; }

          // Add the file to the request.
          formData.append('filehive', file, file.name);
        }

        // appending csrfmiddlewaretoken and user-id
        formData.append('csrfmiddlewaretoken', '{{csrf_token}}');
        formData.append('user','{{request.user.id}}');
        if(!"{{asset_obj}}"){
            formData.append('asset_obj',assetval);
        }
        else{
            formData.append('asset_obj','{{asset_obj}}');
        }
        // Set up the request.
        xhr = new XMLHttpRequest();

        // Open the connection.
        xhr.open('POST', "{% url 'add_assetcontent' group_id %}", true);

        // Set up a handler for when the request finishes sucessfully.
        xhr.onload = function () {
          if (xhr.status === 200) 
          {
            // File(s) uploaded.
           // if file is not uploaded sucessfully
            if(xhr.responseText == "UploadError")
            {
               alert("Error occurred");
            }
            // check if image is not in the list, add it.
            else if(xhr.responseText )
            {
              alert(xhr.responseText);
            }

            uploadButton.innerHTML = 'Upload';

            // updating metadata of files, if file is uploaded sucessfully
            // if(xhr.responseText != "UploadError")
            // {
            //   // alert('xhr.responseText != "UploadError"');
            // }
          }
          else
          {
            alert('An error occurred!');
          }
        };

        // Send the Data.
        xhr.send(formData);
      }

  
</script>
