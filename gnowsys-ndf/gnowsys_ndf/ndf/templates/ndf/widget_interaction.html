{% load i18n %}
{% load ndf_tags %}

    <form data-abide id="form-edit-node" method="POST"   action="{% url 'save_interactions' group_id %}" enctype="multipart/form-data">

{% csrf_token %}
	<input type="hidden" name="node_id" class="form_node_id" value="{{node.pk}}">

        <div class="content contents" id="panel-thread" style="width:95%;" >
        <div class="row">
            <h7>{% trans "Add properties to the discussion feature of this " %}{{title}}{% trans " node "%} </h7>
        </div>

        <div class="row yes_no_disc_div">
          <div class="large-2 medium-4 columns"><h5>{% trans "Interaction : " %}</h5>
          </div>
          <div class="large-6 medium-8 columns">
            <input type="radio" name="thread_create" value="Yes">Yes &nbsp;&nbsp;
            <input type="radio" name="thread_create" value="No" checked="checked">No
          </div>
        </div>
        <div class="thread-settings-div {% if not node.discussion_enable %} hide {% endif %}">
            {% get_thread_node asset_obj.pk as thread_node %}
            {% if thread_node %}
                {% get_attribute_value thread_node.pk 'release_response' as resp_val %}
                {% get_attribute_value thread_node.pk 'thread_interaction_type' as thr_int_type %}
                {% get_attribute_value thread_node.pk 'start_time' as thr_start_time %}
                {% get_attribute_value thread_node.pk 'end_time' as thr_end_time %}
            {% endif %}
            <div class="row">
              <div class="large-2 medium-4 columns "><h5>{% trans "Release Option:" %}</h5>
              </div>
              <div class="large-6 medium-8 columns">
                <select id="release_resp_sel" name="release_resp_sel">
                  <option value="True" {% if resp_val or not grel_dict %} selected{% endif %}>Show Replies to All</option>
                  <option value="False" {% if grel_dict and not resp_val %} selected{% endif %}>Hide Replies from All</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="large-2 medium-4 columns "><h5>{% trans "Interaction Type:" %}</h5>
              </div>
              {% get_gstudio_interaction_types as all_interaction_values %}
              <div class="large-6 medium-8 columns">
                <select id="interaction_type_sel" name="interaction_type_sel">
                {% for each_int in all_interaction_values %}
                  <option value="{{each_int}}" {% if thr_int_type == each_int %} selected {% endif %}>{{each_int}}</option>
                {% endfor %}

                </select>
              </div>
            </div>

        </div>
    </div>      
    <button type="submit" class="right blue-white-button save-metadata">Save Changes</button>
    <button type="button" class="right blue-white-button cancel-metadata">Cancel</button>
  </form>

    <script type="text/javascript">
    	$("input[name=thread_create]").change(function(){
            var radio_sel = $('input[name=thread_create]:checked').val()
            if(radio_sel=="Yes"){
                $(".thread-settings-div").removeClass("hide");
            }
            else{
                $(".thread-settings-div").addClass("hide");
            }
        })


        $("select#release_resp_sel").change(function() {
            $("select#interaction_type_sel").removeAttr("disabled");
        })

        var startEnrollDt = $("#thread_start_date");
        var endEnrollDt = $("#thread_close_date");

        currentDate = new Date();
        var currentDay = currentDate.getDate();
        var currentMonth = currentDate.getMonth();
        var currentYear = currentDate.getFullYear();
        lowerYearLimit = currentYear;
        upperYearLimit = currentYear + 20;


        $(".date_month_day_year").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd/mm/yy',
            yearRange: lowerYearLimit + ":" + upperYearLimit,
            defaultDate: '0',

            onClose: function(dateText, inst) {
              $(this).val(dateText);

              var month_year = $(this).val();
              day = currentDay;
              month = currentMonth;
              year = currentYear;

              if ($(this).attr('id') == "thread_start_date") {
                if (month_year) {
                  month_year = month_year.split("/");
                  day = parseInt(month_year[0]);
                  month = parseInt(month_year[1]);
                  year = parseInt(month_year[2]);
                }

                if (endEnrollDt.val() != '') {
                  var testStartDate = startEnrollDt.datepicker('getDate');
                  var testEndDate = endEnrollDt.datepicker('getDate');

                  if (testStartDate > testEndDate) {
                    endEnrollDt.datepicker('setDate', testStartDate);
                  }

                  else {
                    $(this).val(day+"/"+month+"/"+year);
                    $(this).datepicker('setDate', new Date(year, (month-1), day));
                  }
                }

                else {
                  endEnrollDt.val(day+"/"+month+"/"+year);
                  $(this).datepicker('setDate', new Date(year, (month-1), day));
                }
                $("#thread_close_date").datepicker('option', 'minDate', new Date(year, (month-1), day));
              }

              else if ($(this).attr('id') == "thread_close_date") {
                if (month_year) {
                  month_year = month_year.split("/");
                  day = parseInt(month_year[0]);
                  month = parseInt(month_year[1]);
                  year = parseInt(month_year[2]);
                }

                if (startEnrollDt.val() != '') {
                  var testStartDate = startEnrollDt.datepicker('getDate');
                  var testEndDate = endEnrollDt.datepicker('getDate');

                  if (testStartDate > testEndDate) {
                    startEnrollDt.datepicker('setDate', testEndDate);
                  }
                  else {
                    $(this).val(day+"/"+month+"/"+year);
                    $(this).datepicker('setDate', new Date(year, (month-1), day));
                  }
                }

                else {
                  startEnrollDt.val(day+"/"+month+"/"+year);
                  $(this).datepicker('setDate', new Date(year, (month-1), day));
                }
              }
            },

            beforeShow: function() {
              var month_year = $(this).val();
              day = currentDay;
              month = currentMonth;
              year = currentYear;

              if (month_year) {
                month_year = month_year.split("/");
                day = parseInt(month_year[0]);
                month = parseInt(month_year[1]);
                year = parseInt(month_year[2]);
              }
              $(this).datepicker('option', 'defaultDate', new Date(year, (month-1), day));
              $(this).datepicker('setDate', new Date(year, (month-1), day));
            },
        });

    </script>