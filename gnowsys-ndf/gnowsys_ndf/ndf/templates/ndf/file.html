{% extends "ndf/base.html" %}
{% block title %} {{title}} {% endblock %}

{% block meta_content %}
<p>Upload your files from your computer to metaStudio. You can view the existing files in the group and create collections.</p>

{% endblock %}

{% block search_content %}
<form id ="file_search" enctype="multipart/form-data" method="GET" action="{% url 'image_search' newgroup %}">

  <div class="row collapse">
    <div class="small-10 columns">
      <input type="text" placeholder="search files" name="search">
    </div>
    <div class="small-2 columns">
      <a href="#" class="button postfix" onclick="document.forms[0].submit();return false;">
        <i class="fi-magnifying-glass large"></i>
      </a>
    </div>
  </div>

</form>

{% endblock %}

{% block body_content %}

<header class="row">
  <h2 class="medium-12 columns">Gallery</h2>
  <nav class="medium-12 columns">
   <dl class="tabs" data-tab>
     <dd><h3>View:</h3></dd>
     <dd class="active"><a href="#view-all"><i class="fi-eye"></i> All files</a></dd>
     <dd><a href="#panel2-3"><i class="fi-page-filled"></i> Documents</a></dd>
     <dd><a href="#view-image"><i class="fi-camera"></i>Images</a></dd>
     <dd><a href="#view-video"><i class="fi-video"></i> Videos</a></dd>
     <dd><a href="#panel2-4"><i class="fi-list-thumbnails"></i> File list</a></dd>
   </dl>
 </nav>
</header>

<div class="tabs-content">

  {% load ndf_tags %}
  {% if already_uploaded %} 
  <div id="message">
    <span style="color:red">Listed below files are already uploaded please choose different files</span>
    <ul>
      {% for each in already_uploaded %}
      <li>{{each}}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% load url from future %}

  <!-- Tab View 1 -->
  <div class="content active" id="view-all">
    <!-- Card -->
    <ul class="small-block-grid-1 medium-block-grid-3 large-block-grid-4">

      <!-- Node create card-->
      <li class="create card">
        <div class="file">
          <h4><i class="fi-plus"></i> New Upload</h4>
          <div class="row">
            <div class="large-12 columns">

              <input type="text" placeholder="Name of the File" />
              <textarea placeholder="Describe the File"></textarea>

              <div class="login-mode switch round">

                <input id="PUBLIC" name="login-mode" type="radio" checked>
                <label for="PUBLIC" onclick="">Public <i class="fi-torsos-all"></i></label>

                <input id="PRIVATE" name="login-mode" type="radio">
                <label for="PRIVATE" onclick="">Private <i class="fi-lock"></i></label>

                <span></span>

              </div>

            </div>
          </div>
          {% if user.is_authenticated %}
          <a class="button expand" href="{% url 'uploadDoc' newgroup %}?next={{request.path}}">
            Upload File
          </a>
          {% endif %}
        </li>

        {% if files.count != 0 %}
        <!-- Existing card list-->
        {% for file in files %}
        {% get_user_object file.created_by as user_obj %}
        {% get_grid_fs_object file as grid_fs_obj %}
        <li class="card">
          <div class="file">

            <header>

              <div class="label-list">
                {% for tag in node.tags %}
                <span class="label">{{tag}}</span>
                {% endfor %}
              </div>

              <div class="th"><img src="/static/ndf/images/icon/meta.svg"></div>
              <h4>{{file.name}}</h4>
              <small>Created by <span class="user">{{ user_obj.username }}</span> <em>33 days ago</em></small>

            </header>

            <p>This file is a..</p>

            <a class="button expand" href ="{% url 'read_file' newgroup file grid_fs_obj.filename %}">File details</a>
            {% get_user_object file.created_by as user_obj %}
            {% ifequal  user_obj.username  user.username  %}
            <a  class="button alert tiny" href="{% url 'delete_file' 'group' file %}?next={{request.path}}">Delete </a>
            {% endifequal %}

            <footer class="row">
             <div class="small-6 columns">{{file.mime_type}}</div>
             <div class="small-6 columns"><strong>{{file.file_size.size}}</strong> {{file.file_size.unit}}</div> 
           </footer>

         </div>
       </li>

       {% endfor %}

       {% else %}
       <p><em>Currently NO files uploaded!!!</em></p>
       {% endif %}
     </ul>
   </div>

   <!-- View 2 -->
   <div class="content" id="view-image">
     {% for image in imageCollection %}
     <li  class="clearing-featured-img">
      <a href="{% url 'get_mid_size_img' newgroup image %}">
        <img  src="{% url 'getImageThumbnail' newgroup image %}"  class="th" data-caption="<div class='img_rotate'> <i class='fi-refresh large'></i> </div><a href='{% url 'image_detail' newgroup image %}'>{{image.name}}</a> <script type='text/javascript'>
        var angle = 0;
        $('.img_rotate').on('click', function() {
        angle += 90;
        $('.visible-img img').rotate(angle);
      });
    </script>" >
  </img>
</a>
</li>
{% endfor %}
</div>

<!-- View 3 -->
<div class="content" id="view-video">
 {% for video in videoCollection %}
 <li>
  <a class="video" id="{{video}}" href="#">
    <img src="{% url 'getvideoThumbnail' newgroup video %}" style="border-radius:10px;"></img>
    <span align="left">{{video.name}}</span>
  </a>
  {% get_user_object video.created_by as user_obj %}
  {% ifequal  user_obj.username  user.username  %}
  <a  class="btn btn-block btn-lg btn-danger" href="{% url 'delete_file' 'group' video %}?next={{request.path}}">Delete </a>
  {% endifequal %}
</li>
{% endfor %}


</div>

</div>


{% endblock %}


<!-- Moved from videoDashboard -->
{% block extra_content %} 

<div id="pop_video" style="display:none;position:absolute; top: 20%; left: 15%; background: black; z-index:10000; ">
  <a id="close" href="#"><img width="19px;" style="position: absolute; top: -3%; left: calc(795px);" src="/static/ndf/images/close.jpeg"></a>
  <video id="play_video" src="" controls="controls" style="width:795px; height:450px"></video>
  <br/>
  <span style="float:left"> <a class="video_pre" href="#">&lt;&lt;&lt; previous</a>  </span>  
  <center><span> <a class="video_details_link" href="#"> more details </a></span>
   <span style="float:right"> <a class="video_next" href="#">next &gt;&gt;&gt;</a> </span> 
 </div>
 <div class="joyride-modal-bg" id="backcover" style="display: none;"></div>
 {% endblock %}

 {% block script %}
 var eventhandler = function(e) { e.preventDefault();}

 $(document).on('click',".video",function(){
 //$('#body').css({opacity: "0.4"});
 $("#backcover").show();
 $('#body').bind('click', eventhandler);
 $('#pop_video').show();
 var video_id = this.id;
 var video_index = $('.video').index(this)
 var video_total = $('.video').length;
 var pre = $(".video_pre");
 var next = $(".video_next");
 var url = "/{{newgroup}}/video/fullvideo/"+video_id
 $("#play_video").attr("src",url);
 $(".video_details_link").attr("href","/{{newgroup}}/video/video_detail/"+video_id)
 if(video_index >= 1 && video_index < video_total-1)
 {
 pre.attr("id",video_index-1);
 next.attr("id",video_index+1);
}
else if(video_index == 0)
{
  pre.hide();
  next.attr("id",video_index+1);
}
else if(video_index == video_total-1){
pre.attr("id",video_index-1);
next.hide();
}
else{
pre.hide();
next.hide();
}
});

$(document).on('click',"#close",function(){
$('#pop_video').hide();
$("#backcover").hide();
$("#play_video").attr("src","");
$('#body').css({opacity: "1"});
$('#body').unbind('click', eventhandler);
});

$(document).on('click',".video_pre",function(){
var video_id = this.id;
var video_index = parseInt(this.id);
var video_total = $('.video').length;
var pre = $(".video_pre");
var next = $(".video_next");
pre.show();
next.show();
var video_url = $(".video")[this.id].id
var url = "/{{newgroup}}/video/fullvideo/"+video_url
$("#play_video").attr("src",url);
$(".video_details_link").attr("href","/{{newgroup}}/video/video_detail/"+video_url)
if(video_index >= 1 && video_index < video_total-1)
{
  pre.attr("id",video_index-1);
  next.attr("id",video_index + 1);
}
else if(video_index == 0)
{
  pre.hide();
  next.attr("id",video_index+1);
}
else if(video_index == video_total-1){
pre.attr("id",video_index-1);
next.hide();
}
else{
pre.hide();
next.hide();
}
});

$(document).on('click',".video_next",function(){
var video_id = this.id;
var video_index = parseInt(this.id);
var video_total = $('.video').length;
var pre = $(".video_pre");
var next = $(".video_next");
pre.show();
next.show();
var video_url = $(".video")[this.id].id
var url = "/{{newgroup}}/video/fullvideo/"+video_url
$("#play_video").attr("src",url);
$(".video_details_link").attr("href","/{{newgroup}}/video/video_detail/"+video_url)
if(video_index >= 1 && video_index < video_total-1)
{
  pre.attr("id",video_index-1);
  next.attr("id",video_index+1);
}
else if(video_index == 0)
{
  pre.hide();
  next.attr("id",video_index+1);
}
else if(video_index == video_total-1){
pre.attr("id",video_index-1);
next.hide();
}
else{
pre.hide();
next.hide();
}
});

{% endblock %}
