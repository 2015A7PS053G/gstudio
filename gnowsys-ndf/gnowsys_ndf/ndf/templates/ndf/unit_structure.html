{% block head %}
<script src="/static/ndf/bower_components/handlebars/handlebars.js"></script>
<script type="text/javascript" src="/static/ndf/bower_components/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="/static/ndf/bower_components/ckeditor/config.js"></script>
{% endblock head %}
    <div class="row course_creator">
        <div class="small-12 columns">
            <div class="course_editor ">
                <div class="course_tree">
                    <dl class="accordion course-lessons" data-accordion role="tablist">
                    </dl>
                    <a href="#" class="button-hollow-grey add-lesson" data-reveal-id="myModal">Add Lesson</a>
                      <div id="myModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
                        <h3>Lesson Name</h3>
                        <input type="text" id="lesson-name">
                        <button type="button" class="button-hollow-grey save-lesson">
                          Save Lesson
                        </button>
                        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
                      </div>
                </div>
                <div class="course-editor-section hide">
                    <div class="activity-editor hide">
                        <div class="actvity-editor-header editor-header">
                            <div class="left header-left activity-name-label">
                                <span class="activity-name ">Activity Name</span>
                            </div>
                                
                            <button type="button" class="right button-hollow-blue save_edit_activity" data-current-activity-id="">
                                  Edit
                            </button>
                            
                            <div class="right custom_dropdown">
                                <a href="">More</a>
                                <ul class="dropdown_content right_align">
                                    <li>
                                        <a href="#" class="save_template">Save as template</a>
                                    </li>
                                    <li>
                                        <a href="#" data-reveal-id="existing_template_modal">Create from existing template</a>
                                    </li>
                                    <li>
                                        <a href="#" class="delete_entity">Delete</a>
                                    </li>
                                </ul>
                            </div>

                            
                        </div>
                        <div class="editor-tool hide">
                            <div class="editor_actions">
                                <ul>
                                    <li style="float: left;">
                                        <span>Bold</span>
                                        <span>Italics</span>
                                        <span>OL</span>
                                        <span>UL</span>
                                    </li><li style="float: right;">
                                        <span>+ Assessment</span>
                                    </li><li style="float: right;">
                                        <span data-reveal-id="imageModal">+ Image</span>
                                        <span data-reveal-id="videoModal">+ Video</span>
                                        <span>+ Sound</span>
                                    </li><!--li style="width: 11%; float: right;">
                                        <span data-reveal-id="appModal">+ App</span>
                                    </li-->
                                </ul>
                            </div>
                            Editor tool will come here. //CK Editor
                        </div>
                        <div id="scstyle">
                            
                        <div id="activity-content">

                        </div>
                        </div>
                    </div>
                    <div class="lesson-editor hide">
                        <div class="lesson-editor-header editor-header">
                            <span class="header-title left">Lesson Name</span>
                            <div class="right custom_dropdown">
                                <a href="">More</a>
                                <ul class="dropdown_content right_align">
                                    <li>
                                        <a href="#">Delete</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="editor-tool">
                            <div class="row">
                                <div class="large-12 columns">
                                    <label>Description
                                        <textarea placeholder="Lesson brief description"></textarea>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="videoModal" class="reveal-modal editor_modal tile_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <div style="width: 100%; height: 50px;">
            <div class="editor_modal_title left">Select an video to add it</div>
            <div class="editor_modal_actions right">
                <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
                <a class="button-hollow-purple">Add selected video</a>
            </div>
        </div>
        <div class="editor_modal_content">
            <div class="row">
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="imageModal" class="reveal-modal editor_modal tile_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <div style="width: 100%; height: 50px;">
            <div class="editor_modal_title left">Select an image to add it</div>
            <div class="editor_modal_actions right">
                <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
                <a class="button-hollow-purple">Add selected image</a>
            </div>
        </div>
        <div class="editor_modal_content">
            <div class="row">
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="large-3 medium-6 small-12 columns modal_tile">
                    <a class="th" href="#">
                        <img src="">
                        <span>Image </span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="appModal" class="reveal-modal editor_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <div style="width: 100%; height: 50px;">
            <div class="editor_modal_title left">Select an app to add it</div>
            <div class="editor_modal_actions right">
                <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
                <a class="button-hollow-purple">Add selected app</a>
            </div>
        </div>
        <div class="editor_modal_content">
            <div class="app_row">
                <div style="width: 30%" class="app_image">
                    <div>
                        <img src=""/>
                    </div>
                </div>
                <div style="width: 65%" class="app_desc">
                    <h3>App name 1</h3>
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                        eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
                        ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                        aliquip ex ea commodo consequat. Duis aute irure dolor in
                        reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                        pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                    </p>
                    <button type="button" class="button-hollow-purple">Select this app</button>
                </div>
            </div>
        </div>
    </div>

    {% verbatim %}

    <!-- Handlebar Templates for the course tree -->
    <script id="lesson-template" type="text/x-handlebars-template">
        <dd class="accordion-navigation">
            <a href="#lesson-{{id}}" class="entity-title" id="lesson-accordion">
                {{name}}
                <div class="right edit_entity">
                    <i class="fi-list right"></i>
                    <ul class="entity_actions">
                        <li class="lesson_move_up">Move up</li>
                        <li class="lesson_move_down">Move down</li>
                        <li class="lesson_edit">Edit</li>
                        <li class="lesson_delete">Delete</li>
                    </ul>
                </div>
            </a>
            <div id="lesson-{{id}}" class="content">
                <ul class="course-activities">
                    {{#each activities}}
                        <li id="activity-{{id}}" data-name={{name}}>
                            <a href="#" class="entity-title">{{name}}
                                <div class="right edit_entity">
                                    <i class="fi-list right"></i>
                                    <ul class="entity_actions">
                                        <li class="activity_move_up">Move up</li>
                                        <li class="activity_move_down">Move down</li>
                                        <li class="activity_edit">Edit</li>
                                        <li class="activity_delete">Delete</li>
                                    </ul>
                                </div>
                            </a>
                        </li>
                    {{/each}}
                    <li>
                        <div class="custom_dropdown">
                            <a href="#" class="button-hollow-grey add_activity">Add Activity</a>
                            <ul class="dropdown_content left_align" >
                                <li>
                                    <a href="#" data-reveal-id="add-activity-modal" class="right add_activity">Create new</a>
                                </li>
                                <li>
                                    <a href="#" data-reveal-id="select-activity-page">Select from Activity Pages</a>
                                </li>
                            <!--
                                <li>
                                    <a href="#">Create from existing template</a>
                                </li>
                            -->
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </dd>
    </script>
    {% endverbatim %}

        <div id="add-activity-modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
      <h3>Activity Name</h3>
      <input type="text" id="activity-name">
      <button type="button" class="button-hollow-grey save-activity" data-lesson-id="">
        Save Activity
      </button>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>

    </div>

    <div id="select-activity-page" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
      <h3>Choose Activity Page</h3>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

<div id="existing_template_modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
      <h3>Choose Templates</h3>
      <!-- <input type="text" id="activity-name">
      <button type="button" class="button-hollow-grey save-activity" data-lesson-id="">
        Save Activity
      </button> -->
      <div id="template-container"></div>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

    <!-- Javascript operations -->
  <script type="text/javascript">
    // var course_data = [
    //     {
    //         name: 'Lesson1',
    //         type: 'lesson',
    //         id: 'l1',
    //         activities: [
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a1'
    //             },
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a2'
    //             }
    //         ]
    //     }, {
    //         name: 'Lesson2',
    //         type: 'lesson',
    //         id: 'l2',
    //         activities: [
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a1'
    //             },
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a2'
    //             }
    //         ]
    //     }, {
    //         name: 'Lesson3',
    //         type: 'lesson',
    //         id: 'l3',
    //         activities: [
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a1'
    //             },
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a2'
    //             }
    //         ]
    //     }
    // ];
    var course_data = {{unit_structure|safe}};
    // console.log(course_data)
    $(function(){

        /**
        *    Tree related javascript
        *
        */

        // Initializing foundation accordian
        $(document).foundation({
            accordion: {
                multi_expand: true
            }
        });

        // Rendering function for the course tree
        var course_source = $("#lesson-template").html();
        var course_template = Handlebars.compile(course_source);

        function renderCourseTree(data) {
            var courseHtml = '';
            $.each(data, function(ind, lesson){
                courseHtml += course_template(lesson);
            });
            $('.course_editor .course-lessons').html(courseHtml);

            assignEvents();
        }

        //Managing states and events on the tree.
        var lastClickedActivity;
        var selectedEntity;
        var selectedEntityId;
        var editorMode = 'view';

        function assignEvents() {
            lastClickedActivity = undefined;
            $(document).foundation('accordion', 'reflow');
        }

        /*
        * Handlers and actions for the lesson
        */

        $('.course-lessons').on('click', '.edit_lesson' ,function(e){
            e.stopPropagation();
            e.preventDefault();
        });

        // Edit a lesson
        $('.course-lessons').on('click', '.lesson_edit' ,function(e){
            e.stopPropagation();
            e.preventDefault();
            $('.course_editor').addClass('edit_mode');
            var lesson_id = $(this).closest('a').attr('href').replace('#lesson-', '');

            selectedEntity = 'lesson';
            selectedEntityid = lesson_id;

            setTimeout(function(){
                $('.course-editor-section').removeClass('hide');
            }, 1000);
            $('.lesson-editor').removeClass('hide');
            $('.activity-editor').addClass('hide');

            //Ajax to get the data for the activity
            // aaa = this
            // console.log("oooooooooooooooo" + lesson_id)
        });


        // Move a lesson down
        $('.course-lessons').on('click', '.lesson_move_down' ,function(e){
            var $current = $(this).closest('a#lesson-accordion')
            var $next = $current.parent('dd').next('dd')
            var parent_node = "{{group_id}}"; // unit_node in this case
            var curr_lesson_id = $current.attr('href').replace('#lesson-', '');
            var next_lesson_id = $next.find('a#lesson-accordion').attr('href').replace('#lesson-', '');

            //Ajax to move the lesson up.
            $.ajax({
                url: "{% url 'change_order' group_id %}",

                data: {
                    node_id_up: next_lesson_id,
                    node_id_down: curr_lesson_id,
                    parent_node: parent_node,
                    'csrfmiddlewaretoken': "{{csrf_token}}"
                },

                type: "POST",

                dataType: "json",

                success: function(data){
                    success_state = data["success"]
                    if(success_state){
                        $current.parent('dd').insertAfter($next);
                    }
                },
            });//end of ajax


            // var lesson_id = $(this).closest('a').attr('href').replace('#lesson-', '');

            //Ajax to move the lesson up.
            // console.log('Ajax call to move an activity. ' + lesson_id);
            //Update the course_data after successful movedown and call rerender.

        });

        // Move a lesson up
        $('.course-lessons').on('click', '.lesson_move_up' ,function(e){
            var $current = $(this).closest('a#lesson-accordion')
            var $previous = $current.parent('dd').prev('dd')
            var parent_node = "{{group_id}}"; // unit_node in this case
            var curr_lesson_id = $current.attr('href').replace('#lesson-', '');
            var prev_lesson_id = $previous.find('a#lesson-accordion').attr('href').replace('#lesson-', '');

            //Ajax to move the lesson up.
            $.ajax({
                url: "{% url 'change_order' group_id %}",

                data: {
                    node_id_up: curr_lesson_id,
                    node_id_down: prev_lesson_id,
                    parent_node: parent_node,
                    'csrfmiddlewaretoken': "{{csrf_token}}"
                },

                type: "POST",

                dataType: "json",

                success: function(data){
                    success_state = data["success"]
                    if(success_state){
                        $current.parent('dd').insertBefore($previous);
                    }
                },
            });//end of ajax

            // console.log('Ajax call to move an activity. ' + lesson_id);
            //Update the course_data after successful moveup and call rerender.
            // e.stopPropagation();
            // e.preventDefault();

        });

        // Delete a lesson
        $('.course-lessons').on('click', '.lesson_delete' ,function(e){
            e.stopPropagation();
            e.preventDefault();

            var lesson_id = $(this).closest('a').attr('href').replace('#lesson-', '');

            //Ajax to delete the lesson.
            console.log('Ajax call to delete an activity. ' + lesson_id);
            //Update the course_data after successful delete and call rerender.

        });


        function addLesson(unitName, unitId) {
          /*
          addLesson()
          - to add lesson of unit.
          */
          if (!unitName) {
            alert('Name can not be empty. Please provide one.');
            return;
          };
          result = undefined;
          $.ajax({
              type: "POST",
              data:{
                  'csrfmiddlewaretoken': "{{csrf_token}}",
                  "name": unitName,
                  "unit_id": "{{unit_obj.pk}}"
              },
              url: "{% url 'lesson_create_edit' group_id %}",
              // datatype: "",
              success: function(data) {
                  // console.log(typeof(data));
                  data_dict = JSON.parse(data);
                  // console.log(data);
                  aaa = data
                  if(data_dict.success){
                      renderCourseTree(data_dict.unit_hierarchy);
                      // handle opening of tree till recently added node with data_dict.msg
                      $('#myModal').foundation('reveal', 'close');
                      result = true;
                  }
                  else{
                      alert(data_dict.msg);
                      result = false;
                  }

              }
          });
          // console.log(result)
          return result;
        }


        //Add a lesson
        $('.save-lesson').on('click', function(){
            console.log('Adding another lessson');
            addLesson($('#lesson-name').val().trim(), 'unitId')

            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To edit the newly created lesson run this $('a[href="#lesson-'+newid+'"] .edit_lesson').trigger('click');
        })


        // add/save activity
        function addActivity(activityName, lessonId) {
          /*
          addActivity()
          - to add activity of lesson of unit.
          */
          if (!activityName) {
            alert('Name can not be empty. Please provide one.');
            return;
          };
          result = undefined;
          $.ajax({
              type: "POST",
              data:{
                  'csrfmiddlewaretoken': "{{csrf_token}}",
                  "unit_id": "{{unit_obj.pk}}",
                  "name": activityName,
                  "lesson_id": lessonId
              },
              url: "{% url 'activity_create_edit' group_id %}",
              // datatype: "",
              success: function(data) {
                  // console.log(typeof(data));
                  data_dict = JSON.parse(data);
                  // console.log(data);
                  aaa = data
                  if(data_dict.success){
                      renderCourseTree(data_dict.unit_hierarchy);
                      // handle opening of tree till recently added node with data_dict.msg
                      $('#add-activity-modal').foundation('reveal', 'close');
                      result = true;
                  }
                  else{
                      alert(data_dict.msg);
                      result = false;
                  }
              }
          });

          // console.log(result)
          return result;
        }


        //Add a activity
        $('.save-activity').on('click', function(){
            console.log('Adding another lessson');
            // aaa = this
            var lesson_id = $('#add-activity-modal button.save-activity').attr('lesson_id');
            console.log(lesson_id);
            addActivity($('#activity-name').val().trim(), lesson_id);

            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To edit the newly created lesson run this $('a[href="#lesson-'+newid+'"] .edit_lesson').trigger('click');
        })


        function getNodeData(node_id)
        {
          var result = undefined;
          $.ajax({
              type: "GET",
              data:{
                  "node_id": node_id,
              },
              url: "{% url 'get_node_json_from_id' group_id %}",
              datatype: "JSON",
              success: function(data) {
                  if (data == "0"){
                    alert('Unable to load data... Something went wrong :(')
                    return false
                  }
                  // aaa = data
                  // console.log(typeof(data));
                  data_dict = JSON.parse(data);
                  // console.log(data_dict);
                  $('#activity-content').html(data_dict.content);
                  return true
              }
          });
        }



        /*
        * Handlers and actions for the Activity
        */

        // Selecting a activity.
        $('.course-lessons').on('click', '.course-activities>li:not(:last-child) a', function(e){
            e.preventDefault();

            $('.course-lessons li[id^="activity-"]').removeClass('active');
            $(this).closest('li').addClass('active');
            // e.g: activity-58bbaf0a5e35e40049f128ee
            var activity_id = $(this).closest('li').attr('id').replace('activity-', '');
            selectedEntity = 'activity';
            selectedEntityid = activity_id;
            lastClickedActivity = activity_id;

            setTimeout(function(){
                $('.course-editor-section').removeClass('hide');
            }, 1000);

            //Ajax to get the data for this activity.
            $('.lesson-editor').addClass('hide');
            $('.activity-editor').removeClass('hide');
            $('.course_editor').addClass('edit_mode');
            // $('#course_creator')
            console.log("activity id: "+ activity_id);

            // update content: name and description of activity.
            var activityName = $('#activity-' + activity_id).attr('data-name');
            // update name field of editor section
            $('.course-editor-section .activity-name').text(activityName);

            getNodeData(activity_id);
            $('.save_edit_activity').attr('data-current-activity-id', activity_id);
        });

        // Add a new activity
        $('.course-lessons').on('click', '.add_activity', function(){
            var lesson_id = $(this).closest('div.content').attr('id').replace('lesson-', '');
            console.log('Adding another activity for lessson ' + lesson_id);

            $('#add-activity-modal button.save-activity').attr('lesson_id', lesson_id);
            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To select the newly created activity run this $('#activity-' + newid).trigger('click');
        });

        // console.log(course_data)
        renderCourseTree(course_data);

        function getTemplates() {
            $.ajax({
                      type: "GET",
                      url: "{% url 'get_group_templates_page' group_id %}",
                      datatype: "html",
                      data:{

                      },
                        success: function(data) {
                          // console.log(data);
                      $("#template-container").html(data);
                            // $('#existing_template_modal').foundation('reveal', 'open');

                      $(".template-list").click(function(event){
                          // get html content in var
                          var nodeContent = $(this).children('div').attr("data-content");
                          if (editorMode != "edit"){
                              // console.log("jjjjjjjjjjjjjjj " + editorMode);
                            editNode(nodeContent);
                          }
                          else{
                            CKEDITOR.instances['ckeditor_textarea'].setData(nodeContent);
                          }
                          // Open ckeditor and append content of node in ckeditor
                          // openCkEditor('#activity-content', "BasicToolbar", nodeContent);
                          $('#existing_template_modal').foundation('reveal', 'close');
                        });
                      }
                    });
        }

        $(document).on('opened.fndtn.reveal', '#existing_template_modal[data-reveal]', function () {
          // var modal = $(this); // console.log(this);
          getTemplates();
        });


        $(document).on('opened.fndtn.reveal', '#select-activity-page[data-reveal]', function () {
          var modal = $(this); // console.log(this);
          // getTemplates();
        });





        /**
        *    Editor area related javascript
        *   selectedEntity has the selected Entity type
        *   selectedEntityId has the selected Entity Id.
        */

        // Add the jquery specific to the editor area such as the modal button handlers.

        $('.course-editor-section').on('click', '.delete_entity', function(){
            // Call ajax
        });

        $('.course-editor-section').on('click', '.save_template', function(){
            //Call ajax
        });

        function openCkEditor(editorContainerIdOrEl, toolbarType, content)
        {
          $.ajax({
            type: "GET",
            // url: "{% url 'get_ckeditor' group_id %}",
            url: "/home/ajax/get_ckeditor",
            datatype: "html",
            data:{
                    'ckeditor_toolbar' : toolbarType
              },
            success: function(data) {
                $(editorContainerIdOrEl).html(data);
                CKEDITOR.instances['ckeditor_textarea'].setData(content);
                }
            });
        }

        function closeCkEditor()
        {
          $(".cke_button__closebtn_label").trigger( "click" );
        }

        function saveNode(nodeId, nodeName, nodeContent) {
          // console.log(nodeId)
          // console.log(nodeName)
          // console.log(nodeContent)
          $.ajax({
            type: "POST",
            url: "{% url 'save_node' group_id %}",
            // datatype: "JSON",
            data:{
                    'node_id' : nodeId,
                    'name' : nodeName,
                    'content' : nodeContent,
                    'csrfmiddlewaretoken': '{{csrf_token}}'
              },
              success: function(data) {
                  if (data == '0'){
                    alert('Failed to save data. Please try again.');
                    return 0;
                  }
                  data_dict = JSON.parse(data);
                  closeCkEditor();
                  $("#activity-content").html(data_dict.content);
                }
            });
        }

        function editNode(nodeContent) {
          editorMode = 'edit';
          $('.save_edit_activity').html('Save');
          // get html content from #activity-content
          if(!nodeContent){
            var nodeContent = $("#activity-content").html();
          }
          // Open ckeditor and append content of node in ckeditor
          openCkEditor('#activity-content', "GeneralToolbar", nodeContent);
        }

        $('.course-editor-section').on('click', '.save_edit_activity', function(){
            if (editorMode === 'view') {
                console.log('Editing the activity');
                editNode(false);
            }
            else {
                editorMode = 'view';
                // console.log('Saving the activity');
                var nodeContent = CKEDITOR.instances['ckeditor_textarea'].getData();
                // console.log(content_val);
                nodeId = $('.save_edit_activity').attr('data-current-activity-id');
                nodeName = 'a1';
                saveNode(nodeId, nodeName, nodeContent);
                //Do the ajax to save the activity and then following command;
                $('.save_edit_activity').html('Edit');
            }
        })


        // $(document).on('opened.fndtn.reveal', '[add-activity-modal]', function () {
        //   var modal = $(this);
        //   console.log(this);
        // });


    })
  </script>
