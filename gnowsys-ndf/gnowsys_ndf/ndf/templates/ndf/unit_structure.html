{% block head %}
    <script src="/static/ndf/bower_components/handlebars/handlebars.js"></script>
{% endblock head %}

<div class="row course_creator">
    <div class="small-12 columns">
        <div class="course_editor ">

            <!-- Left PANEL -->
            <div class="course_tree">
                <dl class="accordion course-lessons" data-accordion role="tablist">
                </dl>
                <a class="button-hollow-grey add-lesson" data-reveal-id="add-lesson-reveal">Add Lesson</a>
                <!-- overlay/reveal to add lesson -->
                <div id="add-lesson-reveal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
                    <h3>Lesson Name</h3>
                    <input type="text" id="lesson-name">
                    <button type="button" class="button-hollow-grey save-lesson"> Save Lesson </button>
                    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
                </div>
                <!-- END of overlay/reveal to add lesson -->
            </div>
            <!-- END of LEFT PANEL -->

            <!-- Right panel -->
            <div class="course-editor-section hide">
                <div class="activity-editor hide">
                    <!-- Right panel Header -->
                    <div class="actvity-editor-header editor-header">
                        <div class="left header-left activity-name-label">
                            <span class="activity-name"><!-- Activity Name --></span>
                        </div>

                        <button type="button" class="right button-hollow-blue save_edit_activity" data-current-activity-id=""> Edit </button>

                        <!-- commenting following as activities now will be created/edited
                        from activity area -->
                        <!--
                        <div class="right custom_dropdown">
                            <a href="">More</a>
                            <ul class="dropdown_content right_align">
                                <li> <a class="save_template">Save as template</a> </li>
                                <li> <a data-reveal-id="existing_template_modal">Create from existing template</a> </li>
                                <li> <a class="delete_entity">Delete</a> </li>
                            </ul>
                        </div>
                        -->
                    </div>
                    <!-- END of Right panel Header -->

                    <!-- commenting following as activities now will be created/edited from activity area-->
                    <!-- editor we are using is ck Editor -->
                    <!--
                    <div class="editor-tool hide">
                        <div class="editor_actions">
                            <ul>
                                <li style="float: left;">
                                    <span>Bold</span>
                                    <span>Italics</span>
                                    <span>OL</span>
                                    <span>UL</span>
                                </li><li style="float: right;">
                                    <span>+ Assessment</span>
                                </li><li style="float: right;">
                                    <span data-reveal-id="imageModal">+ Image</span>
                                    <span data-reveal-id="videoModal">+ Video</span>
                                    <span>+ Sound</span>
                                </li>
                                <li style="width: 11%; float: right;">
                                    <span data-reveal-id="appModal">+ App</span>
                                </li>
                            </ul>
                        </div>
                        Editor tool will come here. //CK Editor
                    </div>
                    <div id="scstyle">
                     -->

                    <div id="activity-content">
                        <!-- selected activities content will go here (JS) -->
                    </div>
                </div>
            </div>
            <!-- END of Right panel -->

            <!-- commented following because we are not using lesson editor -->
            <!--
            <div class="lesson-editor hide">
                <div class="lesson-editor-header editor-header">
                    <span class="header-title left">Lesson Name</span>
                    <div class="right custom_dropdown">
                        <a href="">More</a>
                        <ul class="dropdown_content right_align">
                            <li>
                                <a href="#">Delete</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="editor-tool">
                    <div class="row">
                        <div class="large-12 columns">
                            <label>Description
                                <textarea placeholder="Lesson brief description"></textarea>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            -->
        </div>
    </div>
</div>


<!-- OVERLAY / REVEAL-MODALS -->

<!-- commented following because edit/create of activity will happen from activities area -->

<!--
VIDEO
<div id="videoModal" class="reveal-modal editor_modal tile_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <div style="width: 100%; height: 50px;">
        <div class="editor_modal_title left">Select an video to add it</div>
        <div class="editor_modal_actions right">
            <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
            <a class="button-hollow-purple">Add selected video</a>
        </div>
    </div>
    <div class="editor_modal_content">
        <div class="row">
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
        </div>
    </div>
</div>

IMAGE
<div id="imageModal" class="reveal-modal editor_modal tile_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <div style="width: 100%; height: 50px;">
        <div class="editor_modal_title left">Select an image to add it</div>
        <div class="editor_modal_actions right">
            <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
            <a class="button-hollow-purple">Add selected image</a>
        </div>
    </div>
    <div class="editor_modal_content">
        <div class="row">
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="large-3 medium-6 small-12 columns modal_tile">
                <a class="th" href="#">
                    <img src="">
                    <span>Image </span>
                </a>
            </div>
        </div>
    </div>
</div>

APP
<div id="appModal" class="reveal-modal editor_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <div style="width: 100%; height: 50px;">
        <div class="editor_modal_title left">Select an app to add it</div>
        <div class="editor_modal_actions right">
            <a class="button-hollow-purple close-reveal-modal" aria-label="Close">Cancel</a>
            <a class="button-hollow-purple">Add selected app</a>
        </div>
    </div>
    <div class="editor_modal_content">
        <div class="app_row">
            <div style="width: 30%" class="app_image">
                <div>
                    <img src=""/>
                </div>
            </div>
            <div style="width: 65%" class="app_desc">
                <h3>App name 1</h3>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
                    ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                    aliquip ex ea commodo consequat. Duis aute irure dolor in
                    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                    pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                </p>
                <button type="button" class="button-hollow-purple">Select this app</button>
            </div>
        </div>
    </div>
</div>

OVERLAY div for adding activity
This will not be used because now only existing activities will be added.
<div id="add-activity-modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h3>Activity Name</h3>
    <input type="text" id="activity-name">
    <button type="button" class="button-hollow-grey save-activity" data-lesson-id="">
    Save Activity
    </button>
    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

TEMPLATE selection for authoring activity
This will not be used because now only existing activities will be added.
<div id="existing_template_modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h3>Choose Templates</h3>
    <div id="template-container"></div>
    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>
-->

<div id="select-activity-page" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog" data-lesson-id="">
    <h3>Choose Activity Page</h3>
    <div id="activity-container"></div>
    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<!-- END of all modals div's -->



{% verbatim %}
<!-- Handlebar Templates for the course tree -->
<script id="lesson-template" type="text/x-handlebars-template">
    <dd class="accordion-navigation">
        <a href="#lesson-{{id}}" class="entity-title" id="lesson-accordion">
            {{name}}
            <div class="right edit_entity">
                <i class="fi-list right"></i>
                <ul class="entity_actions">
                    <li class="lesson_move_up">Move up</li>
                    <li class="lesson_move_down">Move down</li>
                    <li class="lesson_edit">Edit</li>
                    <li class="lesson_delete">Delete</li>
                </ul>
            </div>
        </a>
        <div id="lesson-{{id}}" class="content lesson-container">
            <ul class="course-activities">
                {{#each activities}}
                    <li id="activity-{{id}}" data-name="{{name}}">
                        <a class="entity-title">{{name}}
                            <div class="right edit_entity">
                                <i class="fi-list right"></i>
                                <ul class="entity_actions">
                                    <li class="activity_move_up">Move up</li>
                                    <li class="activity_move_down">Move down</li>
                                    <!--
                                    <li class="activity_edit">Edit</li>
                                    <li class="activity_delete">Delete</li>
                                    -->
                                </ul>
                            </div>
                        </a>
                    </li>
                {{/each}}
                <li>
                    <div class="custom_dropdown">
                        <a data-reveal-id="select-activity-page" class="add_existing_activity"><u>Add from Activities</u></a>
                        <!--
                        <a class="button-hollow-grey add_activity">Add Activity</a>
                         <ul class="dropdown_content left_align" >
                            <li>
                                <a data-reveal-id="add-activity-modal" class="add_activity">Create new</a>
                            </li>
                            <li>
                                <a data-reveal-id="select-activity-page" class="add_existing_activity">Select from Activity Pages</a>
                            </li>
                        </ul>
                        -->
                    </div>
                </li>
            </ul>
        </div>
    </dd>
</script>
{% endverbatim %}



<!-- Javascript operations -->
<script type="text/javascript">
    // Example JSON data req schema/format:
    // var course_data = [
    //     {
    //         name: 'Lesson1',
    //         type: 'lesson',
    //         id: 'l1',
    //         activities: [
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a1'
    //             },
    //             {
    //                 name: 'Activity 1',
    //                 type: 'activity',
    //                 id: 'a2'
    //             }
    //         ]
    //     }
    // ];

    var course_data = {{unit_structure|safe}};

    $(function(){
        /**
        *    Tree related javascript
        *
        */

        // Initializing foundation accordian
        $(document).foundation({
            accordion: {
                multi_expand: true
            }
        });

        // Rendering function for the course tree
        var course_source = $("#lesson-template").html();
        var course_template = Handlebars.compile(course_source);

        function renderCourseTree(data) {
            var courseHtml = '';
            $.each(data, function(ind, lesson){
                courseHtml += course_template(lesson);
            });
            $('.course_editor .course-lessons').html(courseHtml);

            assignEvents();
        }

        //Managing states and events on the tree.
        var lastClickedActivity;
        var selectedEntity;
        var selectedEntityId;
        var editorMode = 'view';

        function assignEvents() {
            lastClickedActivity = undefined;
            $(document).foundation('accordion', 'reflow');
        }

        /*
        * Handlers and actions for the lesson
        */

        $('.course-lessons').on('click', '.edit_lesson' ,function(e){
            e.stopPropagation();
            e.preventDefault();
        });

        // Edit a lesson
        $('.course-lessons').on('click', '.lesson_edit' ,function(e){
            e.stopPropagation();
            e.preventDefault();
            var lesson_id = $(this).closest('a').attr('href').replace('#lesson-', '');

            selectedEntity = 'lesson';
            selectedEntityid = lesson_id;

            // no need to show or collapse to left panel
            // $('.course_editor').addClass('edit_mode');
            // setTimeout(function(){
            //     $('.course-editor-section').removeClass('hide');
            // }, 1000);
            // $('.lesson-editor').removeClass('hide');
            // $('.activity-editor').addClass('hide');

            //Ajax to get data for activity
            console.log("editing lesson: " + lesson_id);
        });


        // Move a lesson down
        $('.course-lessons').on('click', '.lesson_move_down' ,function(e){
            var $current = $(this).closest('a#lesson-accordion')
            var $next = $current.parent('dd').next('dd')
            var parent_node = "{{group_id}}"; // unit_node in this case
            var curr_lesson_id = $current.attr('href').replace('#lesson-', '');
            var next_lesson_id = $next.find('a#lesson-accordion').attr('href').replace('#lesson-', '');
            var return_status = change_order_api(next_lesson_id, curr_lesson_id, parent_node)
            if (return_status){
                $current.parent('dd').insertAfter($next);
            }
        });

        // Move a lesson up
        $('.course-lessons').on('click', '.lesson_move_up' ,function(e){
            var $current = $(this).closest('a#lesson-accordion')
            var $previous = $current.parent('dd').prev('dd')
            var parent_node = "{{group_id}}"; // unit_node in this case
            var curr_lesson_id = $current.attr('href').replace('#lesson-', '');
            var prev_lesson_id = $previous.find('a#lesson-accordion').attr('href').replace('#lesson-', '');
            var return_status = change_order_api(curr_lesson_id, prev_lesson_id, parent_node)
            if (return_status){
                $current.parent('dd').insertBefore($previous);
            }
        });

        //Activity Move Up
        $('.course-lessons').on('click', '.activity_move_down' ,function(e){
            lesson_id = $(this).parents('div.lesson-container')
                            .attr('id').replace('lesson-', '');
            $current = $(this).parents('li');
            $next = $current.next('li');
            var curr_act_id = $current.attr('id').replace('activity-', '');
            var next_act_id = $next.attr('id').replace('activity-', '');
            var return_status = change_order_api(next_act_id, curr_act_id, lesson_id)
            if (return_status) {
                $current.insertAfter($next);
            }
        })

        //Activity Move Up
        $('.course-lessons').on('click', '.activity_move_up' ,function(e){
            lesson_id = $(this).parents('div.lesson-container')
                            .attr('id').replace('lesson-', '');
            $current = $(this).parents('li');
            $previous = $current.prev('li');
            var curr_act_id = $current.attr('id').replace('activity-', '');
            var prev_act_id = $previous.attr('id').replace('activity-', '');
            var return_status = change_order_api(curr_act_id, prev_act_id, lesson_id)
            if (return_status) {
                $current.insertBefore($previous);
            }
        })


        // Delete a lesson
        $('.course-lessons').on('click', '.lesson_delete' ,function(e){
            e.stopPropagation();
            e.preventDefault();

            var lesson_id = $(this).closest('a').attr('href').replace('#lesson-', '');

            //Ajax to delete the lesson.
            console.log('Ajax call to delete an activity. ' + lesson_id);
            //Update the course_data after successful delete and call rerender.
        });


        function addLesson(unitName, unitId) {
          /*
          addLesson()
          - to add lesson of unit.
          */
          if (!unitName) {
            alert('Name can not be empty. Please provide one.');
            return;
          };
          result = undefined;
          $.ajax({
              type: "POST",
              data:{
                  'csrfmiddlewaretoken': "{{csrf_token}}",
                  "name": unitName,
                  "unit_id": "{{unit_obj.pk}}"
              },
              url: "{% url 'lesson_create_edit' group_id %}",
              // datatype: "",
              success: function(data) {
                  // console.log(typeof(data));
                  data_dict = JSON.parse(data);
                  // console.log(data);
                  if(data_dict.success){
                      renderCourseTree(data_dict.unit_hierarchy);
                      // handle opening of tree till recently added node with data_dict.msg
                      $('#add-lesson-reveal').foundation('reveal', 'close');
                      result = true;
                  }
                  else{
                      alert(data_dict.msg);
                      result = false;
                  }

              }
          });
          // console.log(result)
          return result;
        }


        //Add a lesson
        $('.save-lesson').on('click', function(){
            // console.log('Adding another lessson');
            addLesson($('#lesson-name').val().trim(), 'unitId')

            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To edit the newly created lesson run this $('a[href="#lesson-'+newid+'"] .edit_lesson').trigger('click');
        })

        function getNodeData(node_id)
        {
          var result = undefined;
          $.ajax({
              type: "GET",
              data:{
                  "node_id": node_id,
              },
              url: "{% url 'get_node_json_from_id' group_id %}",
              datatype: "JSON",
              success: function(data) {
                  if (data == "0"){
                    alert('Unable to load data... Something went wrong :(')
                    return false
                  }
                  data_dict = JSON.parse(data);
                  $('#activity-content').html(data_dict.content);
                  return true
              }
          });
        }



        /*
        * Handlers and actions for the Activity
        */
        // Selecting a activity.
        $('.course-lessons').on('click', '.course-activities>li:not(:last-child) a', function(e){
            e.preventDefault();

            $('.course-lessons li[id^="activity-"]').removeClass('active');
            $(this).closest('li').addClass('active');
            // e.g: activity-58bbaf0a5e35e40049f128ee
            var activity_id = $(this).closest('li').attr('id').replace('activity-', '');
            selectedEntity = 'activity';
            selectedEntityid = activity_id;
            lastClickedActivity = activity_id;

            setTimeout(function(){
                $('.course-editor-section').removeClass('hide');
            }, 1000);

            //Ajax to get the data for this activity.
            $('.lesson-editor').addClass('hide');
            $('.activity-editor').removeClass('hide');
            $('.course_editor').addClass('edit_mode');
            // $('#course_creator')

            // update content: name and description of activity.
            var activityName = $('#activity-' + activity_id).attr('data-name');
            // update name field of editor section
            $('.course-editor-section .activity-name').text(activityName);

            getNodeData(activity_id);
            $('.save_edit_activity').attr('data-current-activity-id', activity_id);
        });

        /*
        // Add a new activity
        $('.course-lessons').on('click', '.add_activity', function(){
            var lesson_id = $(this).closest('div.content').attr('id').replace('lesson-', '');
            // console.log('Adding another activity for lessson ' + lesson_id);

            $('#add-activity-modal button.save-activity').attr('lesson_id', lesson_id);
            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To select the newly created activity run this $('#activity-' + newid).trigger('click');
        });
        */

        // Add a existing activity
        $('.course-lessons').on('click', '.add_existing_activity', function(){
            var lesson_id = $(this).closest('div.content').attr('id').replace('lesson-', '');
            // console.log('Adding existing activity for lessson ' + lesson_id);

            $('#select-activity-page').attr('data-lesson-id', lesson_id);
            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To select the newly created activity run this $('#activity-' + newid).trigger('click');
        });

        renderCourseTree(course_data);

        function getActivityPages() {
            $.ajax({
                      type: "GET",
                      url: "{% url 'get_group_pages' group_id %}",
                      datatype: "html",
                      data:{

                      },
                        success: function(data) {
                      $("#activity-container").html(data);
                            // $('#existing_template_modal').foundation('reveal', 'open');

                      $(".activity-page").click(function(event){
                          event.preventDefault();
                          // get html content in var
                          var activityPgId = $(this).attr("data-id");
                          var activityContent = $(this).attr("data-name");

                          var lessonId = $("#select-activity-page").attr("data-lesson-id");
                          addExistingActivityPage(lessonId, activityPgId);
                          // addActivity($('#activity-name').val().trim(), lesson_id);

                          // if (editorMode != "edit"){
                          //   editNode(nodeContent);
                          // }
                          // else{
                          //   CKEDITOR.instances['ckeditor_textarea'].setData(nodeContent);
                          // }
                          // Open ckeditor and append content of node in ckeditor
                          // openCkEditor('#activity-content', "BasicToolbar", nodeContent);

                          // $('#select-activity-page').foundation('reveal', 'close');
                        });
                      }
                    });
        }

        function addExistingActivityPage(lessonId, activityPgId)
        {
            $.ajax({
              type: "POST",
              data:{
                  'csrfmiddlewaretoken': "{{csrf_token}}",
                  "child_node_id": activityPgId,
                  "parent_node_id": lessonId
              },
              url: "{% url 'add_to_collection_set' group_id %}",
              // datatype: "",
              success: function(data) {
                  if (data == "0") {
                    $('#select-activity-page').foundation('reveal', 'close');
                    alert('Same activity exists in concern lesson.');
                    return 0;
                  }
                  data_dict = JSON.parse(data);
                  renderCourseTree(data_dict);
                  // handle opening of tree till recently added node with data_dict.msg
                  $('#select-activity-page').foundation('reveal', 'close');
                  }
          });
          return 1;
        }


        // foundation reveal modal events handling
        // $(document).on('opened.fndtn.reveal', '#existing_template_modal[data-reveal]', function () {
        //   getTemplates();
        // });

        $(document).on('opened.fndtn.reveal', '#select-activity-page[data-reveal]', function () {
          getActivityPages();
        });

        $(document).on('open.fndtn.reveal', '#add-lesson-reveal', function () {
            $("#lesson-name").val('')
        });
        // END of foundation reveal modal events handling


        /**
        *    Editor area related javascript
        *   selectedEntity has the selected Entity type
        *   selectedEntityId has the selected Entity Id.
        */

        // Add the jquery specific to the editor area such as the modal button handlers.

        $('.course-editor-section').on('click', '.delete_entity', function(){
            // Call ajax
        });


        $('.course-editor-section').on('click', '.save_edit_activity', function(){
            if (editorMode === 'view') {
                // console.log('Editing the activity');
                // editNode(false);
            }
            else {
                editorMode = 'view';
                // var nodeContent = CKEDITOR.instances['ckeditor_textarea'].getData();
                // var nodeId = $('.save_edit_activity').attr('data-current-activity-id');
                // var nodeName = $('#activity-' + nodeId).attr('data-name');
                // saveNode(nodeId, nodeName, nodeContent);
                // //Do the ajax to save the activity and then following command;
                $('.save_edit_activity').html('Edit');
            }
        })

        function change_order_api(node_to_up, node_to_down, parent_id){
            var success_state = false
            $.ajax({
                url: "{% url 'change_order' group_id %}",

                data: {
                    node_id_up: node_to_up,
                    node_id_down: node_to_down,
                    parent_node: parent_id,
                    'csrfmiddlewaretoken': "{{csrf_token}}"
                },

                type: "POST",
                async: false,
                dataType: "json",

                success: function(data){
                    success_state = data["success"]
                },
            });//end of ajax
            return success_state
        }


        /*
        $('.course-editor-section').on('click', '.save_template', function(){
            //Call ajax
                if (Object.keys(CKEDITOR.instances).length > 0 ){
                    var nodeContent = CKEDITOR.instances['ckeditor_textarea'].getData();
                }
                else{
                    var nodeContent = $("#activity-content").text()
                }
                var nodeId = $('.save_edit_activity').attr('data-current-activity-id');
                var nodeName = $('#activity-' + nodeId).attr('data-name');

                $.ajax({
                    type: "POST",
                    url: "{% url 'save_node' group_id %}",
                    data:{
                        'node_id' : nodeId,
                        'name' : nodeName,
                        'content' : nodeContent,
                        'type_of_gst_name': 'Template',
                        'replicate_resource': 'True',
                        'member_of_gst_name': 'Page',
                        'csrfmiddlewaretoken': '{{csrf_token}}'
                    },
                    success: function(data) {
                        if (data == '0'){
                            alert('Failed to save data. Please try again.');
                            return 0;
                        }
                        // console.log(data)
                    }
                });
        });

        function openCkEditor(editorContainerIdOrEl, toolbarType, content)
        {
          $.ajax({
            type: "GET",
            // url: "{% url 'get_ckeditor' group_id %}",
            url: "/home/ajax/get_ckeditor",
            datatype: "html",
            data:{
                    'ckeditor_toolbar' : toolbarType
              },
            success: function(data) {
                $(editorContainerIdOrEl).html(data);
                CKEDITOR.instances['ckeditor_textarea'].setData(content);
                }
            });
        }

        function closeCkEditor()
        {
          $(".cke_button__closebtn_label").trigger( "click" );
        }


        function saveNode(nodeId, nodeName, nodeContent) {
          $.ajax({
            type: "POST",
            url: "{% url 'save_node' group_id %}",
            // datatype: "JSON",
            data:{
                    'node_id' : nodeId,
                    'name' : nodeName,
                    'content' : nodeContent,
                    'member_of_gst_name': "activity",
                    'csrfmiddlewaretoken': '{{csrf_token}}'
              },
              success: function(data) {
                  if (data == '0'){
                    alert('Failed to save data. Please try again.');
                    return 0;
                  }
                  data_dict = JSON.parse(data);
                  closeCkEditor();
                  $("#activity-content").html(data_dict.content);
                }
            });
        }

        function editNode(nodeContent) {
          editorMode = 'edit';
          $('.save_edit_activity').html('Save');
          // get html content from #activity-content
          if(!nodeContent){
            var nodeContent = $("#activity-content").html();
          }
          // Open ckeditor and append content of node in ckeditor
          openCkEditor('#activity-content', "GeneralToolbar", nodeContent);
        }
        */


        /*
        // add/save activity
        function addActivity(activityName, lessonId) {
          // addActivity()
          // - to add activity of lesson of unit.
          if (!activityName) {
            alert('Name can not be empty. Please provide one.');
            return;
          };
          result = undefined;
          $.ajax({
              type: "POST",
              data:{
                  'csrfmiddlewaretoken': "{{csrf_token}}",
                  "unit_id": "{{unit_obj.pk}}",
                  "name": activityName,
                  "lesson_id": lessonId
              },
              url: "{% url 'activity_create_edit' group_id %}",
              // datatype: "",
              success: function(data) {
                  data_dict = JSON.parse(data);
                  if(data_dict.success){
                      renderCourseTree(data_dict.unit_hierarchy);
                      // handle opening of tree till recently added node with data_dict.msg
                      $('#add-activity-modal').foundation('reveal', 'close');
                      result = true;
                  }
                  else{
                      alert(data_dict.msg);
                      result = false;
                  }
              }
          });

          return result;
        }

        //Add a activity
        $('.save-activity').on('click', function(){
            var lesson_id = $('#add-activity-modal button.save-activity').attr('lesson_id');
            // console.log(lesson_id);
            addActivity($('#activity-name').val().trim(), lesson_id);

            //Send the query and update the course_data and call 'renderCourseTree(course_data)'
            //To edit the newly created lesson run this $('a[href="#lesson-'+newid+'"] .edit_lesson').trigger('click');
        })
        **/


        /*
        function getTemplates() {
            $.ajax({
                      type: "GET",
                      url: "{% url 'get_group_templates_page' group_id %}",
                      datatype: "html",
                      data:{

                      },
                        success: function(data) {
                      $("#template-container").html(data);
                        // $('#existing_template_modal').foundation('reveal', 'open');

                      $(".template-list").click(function(event){
                          // get html content in var
                          var nodeContent = $(this).children('div').attr("data-content");
                          if (editorMode != "edit"){
                            editNode(nodeContent);
                          }
                          else{
                            CKEDITOR.instances['ckeditor_textarea'].setData(nodeContent);
                          }
                          // Open ckeditor and append content of node in ckeditor
                          // openCkEditor('#activity-content', "BasicToolbar", nodeContent);
                          $('#existing_template_modal').foundation('reveal', 'close');
                        });
                      }
                    });
        }
        */



    })
</script>
