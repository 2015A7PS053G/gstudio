{% extends "ndf/mis_base_create_edit.html" %}
{% load i18n %}
{% load ndf_tags %}
{% block title %} {{title}} {% endblock %}
{% load pagination_tags %}

{% block style %}
  {{block.super}}

  /* Resetting css-properties for fieldset (also legend, input) */
    /* fieldset (padding-bottom) */ 
    fieldset {
      padding: 1.25rem 1.25rem 1.25rem 1.25rem !important;
    }

    /* legend (background-color) */
    fieldset legend {
      background-color: transparent !important;
    }

    /* input (margin) */
    fieldset input {
      margin: 0 !important;
    }

  /* Setting css-properties for reveal-modal's label */
    div.reveal-modal > label {
      color: white;
      font-weight: bold;
      font-size: 1rem;
    }


    form .row .row .columns {
        padding:0 !important;
        padding-left:0 !important;
    }

{% endblock %}

{% block body_content %} 
  <div id="alertModal" class="reveal-modal medium alert-box radius" data-reveal data-alert>
    <label id="alertModalLabel"></label>
    <a class="close-reveal-modal">&#215;</a>
  </div>

  <form data-abide enctype="multipart/form-data" id="form-edit-node" method="POST" action="">
	{% csrf_token %}
	<li class="hide" id="course-section">
	<div id="course-structure-div" class="tabs-content" style="border-style: solid; border-width: 1.5px; border-color: #0eacb5; padding: 0px 5px;">
      <div class="active content row" id="panel_{{property_order_list.0.0}}">
        <div class="row input-cs-row">
          <div class="small-2 columns">
            <label for="{{property_order_list.0.1.0.name}}" class="right inline"> 
              {% blocktrans with label_val=property_order_list.0.1.0.altnames %} {{label_val}} {% endblocktrans %}
            </label>
          </div>
      	  <div class="small-4 columns end">
        	{% html_widget groupid node.pk property_order_list.0.1.0 %}
    	  </div>
          <div class="small-6 columns">
		        <input type="button" value="Save" class="button small round save-cs">
		        <input type="button" value="Cancel" class="button small round cancel-cs">
	        </div>
	     </div>

        <div class="row">
        	<div class="small-10 small-centered columns sub-section-btn-div">
        		<input type="button" value="Add Sub section" class="button round expand sub-section-btn" disabled="disabled">
        	</div>
        </div>
      </div>
    </div>
    </li>

	<li class="hide" id="course-subsection">
    	<div id="course-structure-div" class="tabs-content" style="border-style: solid; border-width: 1.5px; border-color: #0eacb5; padding: 0px 5px;">
          <div class="active content row" id="panel_{{property_order_list_css.0.0}}">
            <div class="row input-cs-row">
              <div class="small-1 columns">
                <label for="{{property_order_list_css.0.1.0.name}}" class="right inline"> 
                  {% blocktrans with label_val=property_order_list_css.0.1.0.altnames %} {{label_val}} {% endblocktrans %}
                </label>
              </div>
          	  <div class="small-4 columns end">
            	{% html_widget groupid node.pk property_order_list_css.0.1.0 %}
        	  </div>
              <div class="small-4 columns">
                    <input type="button" value="Save" class="button small round save-cs save-css" >
                    <input type="button" value="Cancel" class="button small round cancel-cs cancel-css" >
              </div>
            </div>
          </div>
        </div>
    </li>

    <ul class="ul-course-section">
		<input type="button" class="button expand round" value="Add Course Section" onclick="add_course_section()">
    </ul>

    <!-- Reveal Modals begin -->

    <div id="course_prop" class="reveal-modal medium" data-reveal style="height:500px;overflow:scroll;"> 
    <div class="row">
        <label><h3>Properties</h3></label>
    </div>

    <div class="row">
     <div class="small-4 columns end">
         <label><h5>Enter Minutes</h5></label>
     </div>        

     <div class="small-3 columns end ">
         <input type="text">
     </div>        
     </div>

    <div class="small-4 small-centered columns">
        <input type="button" class="button round expand" name="set_prop" value="Done">        
    </div>

    <a class="close-reveal-modal">&#215;</a>
    </div>
    <!-- Reveal Model end -->  
  </form>
{% endblock %}

{% block script %}
  {{block.super}}
//<script>
//Global var declarations
  var cs_cloned_id = 1
  var css_cloned_id = 1

//Adding Course Section
  function add_course_section(){
    $(".ul-course-section").before($("#course-section").clone().attr('id',function(i,id){
     cloned_ele_id = id+"_cloned"+cs_cloned_id;
     return cloned_ele_id
     }).removeClass("hide"));
    // $("#"+cloned_ele_id).find("input").each(function(){
    //     $(this).attr("id",function(i,id){
    //         return id+"_cloned"+cs_cloned_id;
    //     });
    // });
    cs_cloned_id+=1
  }  

//Adding Course Subsection

    $(document).on('click','.sub-section-btn',function(){
        parent_id = $(this).parents("li").attr("id")
        $("#"+parent_id).find("input.sub-section-btn").attr("disabled",true)
        $(this).before($("#course-subsection").clone().attr('id',function(i,id){
        cloned_ss_ele_id = id+"_cloned"+css_cloned_id;
        return cloned_ss_ele_id}).removeClass("hide"));
        css_cloned_id+=1

    });

//Save Course Section and Course Subsection
  $(document).on('click','.save-cs',function(){
    parent_id = $(this).parents("li").attr("id")
    lbl_val = $("#"+parent_id).find("input[id='name']").val()
    if(lbl_val==""){
        alert("Please enter Name");
        event.preventDefault();
    }
    else{
        var str_btn="<div class='row'><div class='small-2 columns text-center'><i class='fi-minus large fold-btn'></i></div>"
        var str_lbl="<div class='small-8 columns'><label id='lbl_for_"+parent_id +"'><h4>"+lbl_val+"</h4></label></div>"
        var str_prop="<div class='small-2 columns end'><i class='fi-widget large' onclick='reveal_prop_form()'></i></div></div>"
        $("#"+parent_id).find("div.input-cs-row").replaceWith(str_btn+str_lbl+str_prop)

        if($(this).hasClass("save-css")){
            $("#"+parent_id).parents("li").find("input.sub-section-btn").removeAttr("disabled")   
        }
        else{
            $("#"+parent_id).find("input.sub-section-btn").removeAttr("disabled")
        }
    }
  })

// Cancel Course Section and Course Subsection
  $(document).on('click','.cancel-cs',function(){
    parent_id = $(this).parents("li").attr("id")
    if($(this).hasClass("cancel-css")){
        $("#"+parent_id).parents("li").find("input.sub-section-btn").removeAttr("disabled")   
    }
    else{
        $("#"+parent_id).find("input.sub-section-btn").removeAttr("disabled")
    }
    $("#"+parent_id).remove()
  });

  function reveal_prop_form(){
    $('#course_prop').foundation('reveal', 'open');
  }

  $(document).on('click','.fold-btn',function(){
    parent_id = $(this).parents("li").attr("id");
    if($("#"+parent_id).hasClass("hidden_children")){
        $(this).removeClass("fi-plus").addClass("fi-minus");
        $("#"+parent_id).find("li").removeClass("hide");
        $("#"+parent_id).removeClass("hidden_children");
    }
    else{
        $(this).removeClass("fi-minus").addClass("fi-plus")
        $("#"+parent_id).find("li").addClass("hide");
        $("#"+parent_id).addClass("hidden_children");
    }
    
  });

  </script>
{% endblock %}
